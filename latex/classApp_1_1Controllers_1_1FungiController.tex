\doxysection{Referencia de la clase App\textbackslash{}Controllers\textbackslash{}Fungi\+Controller}
\hypertarget{classApp_1_1Controllers_1_1FungiController}{}\label{classApp_1_1Controllers_1_1FungiController}\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}


Controlador para la gestión de hongos (fungi) en la aplicación.  




Diagrama de colaboración de App\textbackslash{}Controllers\textbackslash{}Fungi\+Controller\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=257pt]{classApp_1_1Controllers_1_1FungiController__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Métodos públicos}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_af7000ed08fe4bc6c08d0b40591e112b7}{\+\_\+\+\_\+construct}} (\$db)
\begin{DoxyCompactList}\small\item\em Constructor de la clase Fungi\+Controller. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a22e3774bb984c19ec5d27ef0b1a5c0a2}{add\+Fungi}} (\$data, \$user=null)
\begin{DoxyCompactList}\small\item\em Añade un nuevo hongo a la base de datos. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a9d16717512fc95fa89a23c45ad840b7b}{detail\+Fungus\+Handler}} (\$twig, \$db, \$session, \$params=\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em Manejador para la ruta de detalles del hongo. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a623e08077cc3c4feb42a54f7d0b4ff59}{get\+All\+Fungi}} ()
\begin{DoxyCompactList}\small\item\em Obtiene la lista completa de hongos. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a4ffbe0ed56de5d30704aacfe173063bf}{get\+Detailed\+Fungus\+By\+Id}} (\$id, \$user\+Id=null)
\begin{DoxyCompactList}\small\item\em Obtiene detalles completos de un hongo específico, incluyendo estadísticas. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a204769e16352593459618d6a1d8bbfb8}{get\+Fungi\+By\+Edibility}} (\$edibility)
\begin{DoxyCompactList}\small\item\em Obtiene hongos filtrados por comestibilidad. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a7fd0c204c87ee0c438191d972dda492b}{get\+Fungi\+Paginated}} (\$page, \$limit)
\begin{DoxyCompactList}\small\item\em Obtiene hongos con paginación. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a0bb355407938be2032959dd234e0b13c}{get\+Fungus\+By\+Id}} (\$id)
\begin{DoxyCompactList}\small\item\em Obtiene un hongo por su ID. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451}{get\+Fungus\+With\+Like\+Status}} (\$fungus, \$user\+Id)
\begin{DoxyCompactList}\small\item\em Añade el estado de like de un usuario a la información de un hongo. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a3a07c5dd018b701663a2a46a52f74a6d}{get\+Random\+Fungus}} ()
\begin{DoxyCompactList}\small\item\em Obtiene un hongo aleatorio de la base de datos. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_adb3b5543b0cbd42fe6278ffb80df47a3}{get\+Random\+Fungus\+With\+Details}} (\$user\+Id=null)
\begin{DoxyCompactList}\small\item\em Obtiene un hongo aleatorio. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a35fbbcc5cad471348611c0e1cfafebd7}{has\+User\+Liked\+Fungi}} (\$user\+Id, \$fungi\+Id)
\begin{DoxyCompactList}\small\item\em Verifica si un usuario ha dado like a un hongo. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a4e795756d06c8d0ff755c20645eddb12}{increment\+Fungi\+Views}} (\$fungi\+Id)
\begin{DoxyCompactList}\small\item\em Incrementa el contador de vistas de un hongo. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a61834711a6b3748eca87a0644c08babb}{like\+Fungi}} (\$user\+Id, \$fungi\+Id)
\begin{DoxyCompactList}\small\item\em Registra que un usuario ha dado like a un hongo. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_ade6fc0ad20f30ba8d2ba5efcf3d7064c}{random\+Fungus\+Handler}} (\$twig, \$db, \$session)
\begin{DoxyCompactList}\small\item\em Manejador para la ruta de hongo aleatorio. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_abad44269a6c73137a0beec822ae8a627}{search\+Fungi}} (\$param, \$value)
\begin{DoxyCompactList}\small\item\em Busca hongos por parámetro y valor. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a087b8275e77143716ac62ea228074a20}{unlike\+Fungi}} (\$user\+Id, \$fungi\+Id)
\begin{DoxyCompactList}\small\item\em Elimina el like de un usuario a un hongo. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_abd8eabf4c1f810b847481dc4af02691b}{update\+Fungi}} (\$fungi\+Id, \$data, \$user=null)
\begin{DoxyCompactList}\small\item\em Actualiza la información de un hongo. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Métodos privados}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a7f868fa3d67eefa14cd17d62e80b3d3d}{get\+Image\+Base\+Path}} (\$config\+Key)
\begin{DoxyCompactList}\small\item\em Obtiene la ruta base para las imágenes según la clave de configuración. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a69ba801a8491aa101cefc5928144e616}{load\+Fungus\+Images}} (\$fungus)
\begin{DoxyCompactList}\small\item\em Carga las imágenes relacionadas con un hongo desde la tabla de relaciones. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_af994c3d12f7062ddd44a40c3505bff3d}{update\+Fungi\+Likes}} (\$fungi\+Id, \$increment)
\begin{DoxyCompactList}\small\item\em Actualiza el contador de likes de un hongo. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Atributos privados}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_ab1b8e71c0976e182854ff195764611c6}{\$db}}
\end{DoxyCompactItemize}


\doxysubsection{Descripción detallada}
Controlador para la gestión de hongos (fungi) en la aplicación. 

Esta clase maneja las operaciones relacionadas con los hongos, incluyendo likes, vistas y consultas de información 

Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00013}{13}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.



\doxysubsection{Documentación de constructores y destructores}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_af7000ed08fe4bc6c08d0b40591e112b7}\label{classApp_1_1Controllers_1_1FungiController_af7000ed08fe4bc6c08d0b40591e112b7} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!\_\_construct@{\_\_construct}}
\index{\_\_construct@{\_\_construct}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{\_\_construct()}{\_\_construct()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::\+\_\+\+\_\+construct (\begin{DoxyParamCaption}\item[{}]{\$db }\end{DoxyParamCaption})}



Constructor de la clase Fungi\+Controller. 


\begin{DoxyParams}[1]{Parámetros}
object & {\em \$db} & Instancia del controlador de base de datos \\
\hline
\end{DoxyParams}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00023}{23}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00024\ \ \ \ \ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \$this-\/>db\ =\ \mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_ab1b8e71c0976e182854ff195764611c6}{\$db}};}
\DoxyCodeLine{00026\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{FungiController_8php_source_l00016}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}\$db}}.



\doxysubsection{Documentación de funciones miembro}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a22e3774bb984c19ec5d27ef0b1a5c0a2}\label{classApp_1_1Controllers_1_1FungiController_a22e3774bb984c19ec5d27ef0b1a5c0a2} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!addFungi@{addFungi}}
\index{addFungi@{addFungi}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{addFungi()}{addFungi()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::add\+Fungi (\begin{DoxyParamCaption}\item[{}]{\$data,  }\item[{}]{\$user = {\ttfamily null} }\end{DoxyParamCaption})}



Añade un nuevo hongo a la base de datos. 


\begin{DoxyParams}[1]{Parámetros}
array & {\em \$data} & Datos del nuevo hongo \\
\hline
array & {\em \$user} & Usuario que realiza la operación \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Resultado de la operación 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00377}{377}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00378\ \ \ \ \ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ permisos\ de\ administrador\ si\ se\ proporciona\ usuario}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$user\ \&\&\ (!isset(\$user[\textcolor{stringliteral}{'role'}])\ ||\ \$user[\textcolor{stringliteral}{'role'}]\ !==\ \textcolor{stringliteral}{'admin'}))\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'No\ tienes\ permisos\ para\ crear\ nuevos\ hongos'}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Validar\ campos\ obligatorios\ (actualizados\ para\ coincidir\ con\ createFungi)}}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \$requiredFields\ =\ [\textcolor{stringliteral}{'name'},\ \textcolor{stringliteral}{'edibility'},\ \textcolor{stringliteral}{'habitat'}];}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\$requiredFields\ as\ \$field)\ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!isset(\$data[\$field])\ ||\ empty(\$data[\$field]))\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{"{}El\ campo\ '\{\$field\}'\ es\ obligatorio"{}}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Preparar\ campos\ y\ valores\ para\ la\ inserción}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \$allowedFields\ =\ [\textcolor{stringliteral}{'name'},\ \textcolor{stringliteral}{'edibility'},\ \textcolor{stringliteral}{'habitat'},\ \textcolor{stringliteral}{'observations'},\ \textcolor{stringliteral}{'common\_name'},\ \textcolor{stringliteral}{'synonym'},\ \textcolor{stringliteral}{'title'}];}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \$fields\ =\ [];}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \$values\ =\ [];}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \$placeholders\ =\ [];}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\$data\ as\ \$field\ =>\ \$value)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_array(\$field,\ \$allowedFields))\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$fields[]\ =\ \$field;}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$values[]\ =\ \$value;}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$placeholders[]\ =\ \textcolor{charliteral}{'?'};}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (empty(\$fields))\ \{}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'No\ se\ proporcionaron\ campos\ válidos\ para\ crear\ el\ hongo'}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \$sql\ =\ \textcolor{stringliteral}{"{}INSERT\ INTO\ fungi\ ("{}}\ .\ implode(\textcolor{stringliteral}{',\ '},\ \$fields)\ .\ \textcolor{stringliteral}{"{})\ VALUES\ ("{}}\ .\ implode(\textcolor{stringliteral}{',\ '},\ \$placeholders)\ .\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>db-\/>query(\$sql,\ \$values);}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$result)\ \{}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtener\ el\ ID\ del\ nuevo\ hongo\ insertado}}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$newFungiId\ =\ \$this-\/>db-\/>lastInsertId();}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inicializar\ registro\ en\ fungi\_popularity}}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>db-\/>query(}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}INSERT\ INTO\ fungi\_popularity\ (fungi\_id,\ views,\ likes)\ VALUES\ (?,\ 0,\ 0)"{}},}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$newFungiId]}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Hongo\ creado\ correctamente'},}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'id'}\ =>\ \$newFungiId}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'Error\ al\ crear\ el\ hongo\ en\ la\ base\ de\ datos'}}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}Error\ creando\ hongo:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'Error\ interno\ del\ servidor:\ '}\ .\ \$e-\/>getMessage()}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00451\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a9d16717512fc95fa89a23c45ad840b7b}\label{classApp_1_1Controllers_1_1FungiController_a9d16717512fc95fa89a23c45ad840b7b} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!detailFungusHandler@{detailFungusHandler}}
\index{detailFungusHandler@{detailFungusHandler}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{detailFungusHandler()}{detailFungusHandler()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::detail\+Fungus\+Handler (\begin{DoxyParamCaption}\item[{}]{\$twig,  }\item[{}]{\$db,  }\item[{}]{\$session,  }\item[{}]{\$params = {\ttfamily \mbox{[}\mbox{]}} }\end{DoxyParamCaption})}



Manejador para la ruta de detalles del hongo. 


\begin{DoxyParams}[1]{Parámetros}
object & {\em \$twig} & Instancia de Twig \\
\hline
object & {\em \$db} & Instancia de la base de datos \\
\hline
object & {\em \$session} & Controlador de sesión \\
\hline
array & {\em \$params} & Parámetros de la ruta \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Datos para la plantilla 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00269}{269}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00270\ \ \ \ \ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \$id\ =\ \textcolor{keyword}{null};}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_array(\$params)\ \&\&\ !empty(\$params))\ \{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \$id\ =\ \$params[0]\ ??\ \textcolor{keyword}{null};}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (empty(\$id)\ \&\&\ isset(\$\_SERVER[\textcolor{stringliteral}{'REQUEST\_URI'}]))\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ preg\_match(\textcolor{stringliteral}{'\#\string^/fungi/(\(\backslash\)d+)\$\#'},\ \$\_SERVER[\textcolor{stringliteral}{'REQUEST\_URI'}],\ \$matches);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \$id\ =\ \$matches[1]\ ??\ \textcolor{keyword}{null};}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}FungiController::detailFungusHandler\ -\/\ ID:\ "{}}\ .\ (\$id\ ??\ \textcolor{stringliteral}{'no\ ID'}));\ \ \ \ \ \ \ }
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \$fungus\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a0bb355407938be2032959dd234e0b13c}{getFungusById}}(\$id);}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\$fungus)\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ header(\textcolor{stringliteral}{'Location:\ /404'});}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ exit;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00288\ \ \ \ \ \ \ }
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'title'}\ =>\ \$fungus[\textcolor{stringliteral}{'name'}]\ ??\ \_(\textcolor{stringliteral}{'Detalles\ del\ Hongo'}),}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'fungi'}\ =>\ \$fungus,}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'similar\_fungi'}\ =>\ \$similarFungi\ ??\ [],}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'is\_logged\_in'}\ =>\ \mbox{\hyperlink{routes_8php_abefb3c26429d514777313e9a63d7cbac}{\$session}}-\/>isLoggedIn()}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00295\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{routes_8php_source_l00093}{\$session}} y \mbox{\hyperlink{FungiController_8php_source_l00118}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Fungus\+By\+Id()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a9d16717512fc95fa89a23c45ad840b7b_cgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a623e08077cc3c4feb42a54f7d0b4ff59}\label{classApp_1_1Controllers_1_1FungiController_a623e08077cc3c4feb42a54f7d0b4ff59} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getAllFungi@{getAllFungi}}
\index{getAllFungi@{getAllFungi}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getAllFungi()}{getAllFungi()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+All\+Fungi (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Obtiene la lista completa de hongos. 

\begin{DoxyReturn}{Devuelve}
array Lista de hongos 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00508}{508}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00509\ \ \ \ \ \{}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \$fungi\ =\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}SELECT\ *\ FROM\ fungi"{}});}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},\ }
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'data'}\ =>\ \$fungi}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00515\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a4ffbe0ed56de5d30704aacfe173063bf}\label{classApp_1_1Controllers_1_1FungiController_a4ffbe0ed56de5d30704aacfe173063bf} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getDetailedFungusById@{getDetailedFungusById}}
\index{getDetailedFungusById@{getDetailedFungusById}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getDetailedFungusById()}{getDetailedFungusById()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Detailed\+Fungus\+By\+Id (\begin{DoxyParamCaption}\item[{}]{\$id,  }\item[{}]{\$user\+Id = {\ttfamily null} }\end{DoxyParamCaption})}



Obtiene detalles completos de un hongo específico, incluyendo estadísticas. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$id} & ID del hongo \\
\hline
int | null & {\em \$user\+Id} & ID del usuario actual (para likes) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Detalles del hongo 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00639}{639}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00640\ \ \ \ \ \{}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Consulta\ para\ obtener\ datos\ básicos\ del\ hongo}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \$sql\ =\ \textcolor{stringliteral}{"{}SELECT\ f.*,\ }}
\DoxyCodeLine{00643\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\_CONCAT(DISTINCT\ CONCAT(ic.path,\ i.filename))\ as\ image\_urls\ }}
\DoxyCodeLine{00644\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FROM\ fungi\ f\ }}
\DoxyCodeLine{00645\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ fungi\_images\ fi\ ON\ f.id\ =\ fi.fungi\_id\ }}
\DoxyCodeLine{00646\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ images\ i\ ON\ fi.image\_id\ =\ i.id\ }}
\DoxyCodeLine{00647\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ image\_config\ ic\ ON\ i.config\_key\ =\ ic.config\_key}}
\DoxyCodeLine{00648\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ WHERE\ f.id\ =\ :id}}
\DoxyCodeLine{00649\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\ BY\ f.id"{}};}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \$fungi\ =\ \$this-\/>db-\/>query(\$sql,\ [\textcolor{stringliteral}{'id'}\ =>\ \$id]);}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Procesar\ resultado\ según\ el\ tipo\ de\ retorno\ de\ la\ DB}}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_array(\$fungi)\ \&\&\ !empty(\$fungi))\ \{}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus\ =\ \$fungi[0];}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ }
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'Registro\ no\ encontrado'}}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtener\ estadísticas:\ vistas\ y\ likes}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \$statsSql\ =\ \textcolor{stringliteral}{"{}SELECT\ views,\ likes\ FROM\ fungi\_popularity\ WHERE\ fungi\_id\ =\ ?"{}};}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \$stats\ =\ \$this-\/>db-\/>query(\$statsSql,\ [\$id]);}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!empty(\$stats))\ \{}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus[\textcolor{stringliteral}{'views'}]\ =\ \$stats[0][\textcolor{stringliteral}{'views'}]\ ??\ 0;}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus[\textcolor{stringliteral}{'likes'}]\ =\ \$stats[0][\textcolor{stringliteral}{'likes'}]\ ??\ 0;}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus[\textcolor{stringliteral}{'views'}]\ =\ 0;}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus[\textcolor{stringliteral}{'likes'}]\ =\ 0;}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ hay\ un\ usuario\ autenticado,\ verificar\ si\ le\ dio\ like}}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$userId)\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451}{getFungusWithLikeStatus}}(\$fungus,\ \$userId);}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incrementar\ contador\ de\ vistas}}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a4e795756d06c8d0ff755c20645eddb12}{incrementFungiViews}}(\$id);}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'data'}\ =>\ \$fungus}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00687\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{FungiController_8php_source_l00106}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Fungus\+With\+Like\+Status()}} y \mbox{\hyperlink{FungiController_8php_source_l00074}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}increment\+Fungi\+Views()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a4ffbe0ed56de5d30704aacfe173063bf_cgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a204769e16352593459618d6a1d8bbfb8}\label{classApp_1_1Controllers_1_1FungiController_a204769e16352593459618d6a1d8bbfb8} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getFungiByEdibility@{getFungiByEdibility}}
\index{getFungiByEdibility@{getFungiByEdibility}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getFungiByEdibility()}{getFungiByEdibility()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Fungi\+By\+Edibility (\begin{DoxyParamCaption}\item[{}]{\$edibility }\end{DoxyParamCaption})}



Obtiene hongos filtrados por comestibilidad. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$edibility} & Tipo de comestibilidad \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Lista de hongos filtrados 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00613}{613}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00614\ \ \ \ \ \{}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \$sql\ =\ \textcolor{stringliteral}{"{}SELECT\ f.*,\ GROUP\_CONCAT(DISTINCT\ CONCAT(ic.path,\ i.filename))\ as\ image\_urls\ }}
\DoxyCodeLine{00616\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FROM\ fungi\ f\ }}
\DoxyCodeLine{00617\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ fungi\_images\ fi\ ON\ f.id\ =\ fi.fungi\_id\ }}
\DoxyCodeLine{00618\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ images\ i\ ON\ fi.image\_id\ =\ i.id\ }}
\DoxyCodeLine{00619\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ image\_config\ ic\ ON\ i.config\_key\ =\ ic.config\_key}}
\DoxyCodeLine{00620\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ WHERE\ f.edibility\ LIKE\ ?}}
\DoxyCodeLine{00621\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\ BY\ f.id}}
\DoxyCodeLine{00622\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LIMIT\ 50"{}};}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \$fungi\ =\ \$this-\/>db-\/>query(\$sql,\ [\textcolor{charliteral}{'\%'}\ .\ \$edibility\ .\ \textcolor{charliteral}{'\%'}]);}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'data'}\ =>\ \$fungi}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00630\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a7fd0c204c87ee0c438191d972dda492b}\label{classApp_1_1Controllers_1_1FungiController_a7fd0c204c87ee0c438191d972dda492b} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getFungiPaginated@{getFungiPaginated}}
\index{getFungiPaginated@{getFungiPaginated}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getFungiPaginated()}{getFungiPaginated()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Fungi\+Paginated (\begin{DoxyParamCaption}\item[{}]{\$page,  }\item[{}]{\$limit }\end{DoxyParamCaption})}



Obtiene hongos con paginación. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$page} & Número de página \\
\hline
int & {\em \$limit} & Límite de registros por página \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Resultados paginados 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00460}{460}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00461\ \ \ \ \ \{}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \$offset\ =\ (\$page\ -\/\ 1)\ *\ \$limit;}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Registrar\ lo\ que\ estamos\ haciendo}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}getFungiPaginated:\ Buscando\ página\ \$page\ con\ límite\ \$limit\ (offset\ \$offset)"{}});}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Consulta\ para\ obtener\ los\ hongos\ con\ sus\ imágenes\ -\/\ usar\ query\ en\ lugar\ de\ prepare}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \$sql\ =\ \textcolor{stringliteral}{"{}SELECT\ f.*,\ GROUP\_CONCAT(DISTINCT\ CONCAT(ic.path,\ '/',\ i.filename))\ as\ image\_urls\ }}
\DoxyCodeLine{00469\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FROM\ fungi\ f\ LEFT\ JOIN\ fungi\_images\ fi\ ON\ f.id\ =\ fi.fungi\_id\ }}
\DoxyCodeLine{00470\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ images\ i\ ON\ fi.image\_id\ =\ i.id\ LEFT\ JOIN\ image\_config\ ic\ ON\ i.config\_key\ =\ ic.config\_key}}
\DoxyCodeLine{00471\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\ BY\ f.id\ LIMIT\ ?,\ ?"{}};}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \$fungi\ =\ \$this-\/>db-\/>query(\$sql,\ [\$offset,\ \$limit]);}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Registrar\ lo\ que\ obtuvimos}}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}getFungiPaginated:\ Encontrados\ "{}}\ .\ (is\_array(\$fungi)\ ?\ count(\$fungi)\ :\ \textcolor{stringliteral}{'no'})\ .\ \textcolor{stringliteral}{"{}\ hongos"{}});}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_array(\$fungi)\ \&\&\ count(\$fungi)\ >\ 0)\ \{}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}Primer\ hongo:\ "{}}\ .\ json\_encode(\$fungi[0]));}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Asegurarnos\ de\ que\ \$fungi\ sea\ un\ array}}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \$fungi\ =\ is\_array(\$fungi)\ ?\ \$fungi\ :\ [];}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Consulta\ para\ contar\ el\ total\ de\ hongos}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \$totalCount\ =\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}SELECT\ COUNT(*)\ as\ total\ FROM\ fungi"{}});}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_array(\$totalCount)\ \&\&\ !empty(\$totalCount))\ \$totalCount\ =\ \$totalCount[0][\textcolor{stringliteral}{'total'}]\ ??\ count(\$totalCount);}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \$totalCount\ =\ 0;}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}getFungiPaginated:\ Total\ de\ hongos:\ \$totalCount"{}});}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calcular\ la\ información\ de\ paginación}}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \$totalPages\ =\ ceil(\$totalCount\ /\ \$limit);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},\ }
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'data'}\ =>\ \$fungi,}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'pagination'}\ =>\ [}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'current\_page'}\ =>\ (int)\$page,}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'total\_pages'}\ =>\ (\textcolor{keywordtype}{int})\$totalPages,}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'records\_per\_page'}\ =>\ (int)\$limit,}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'total\_records'}\ =>\ (\textcolor{keywordtype}{int})\$totalCount}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00501\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a0bb355407938be2032959dd234e0b13c}\label{classApp_1_1Controllers_1_1FungiController_a0bb355407938be2032959dd234e0b13c} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getFungusById@{getFungusById}}
\index{getFungusById@{getFungusById}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getFungusById()}{getFungusById()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Fungus\+By\+Id (\begin{DoxyParamCaption}\item[{}]{\$id }\end{DoxyParamCaption})}



Obtiene un hongo por su ID. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$id} & ID del hongo a buscar \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array\texorpdfstring{$\vert$}{|}null Datos del hongo o null si no se encuentra 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00118}{118}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00119\ \ \ \ \ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}SELECT\ f.*,\ }}
\DoxyCodeLine{00121\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\_CONCAT(DISTINCT\ CONCAT(ic.path,\ i.filename))\ as\ image\_urls\ }}
\DoxyCodeLine{00122\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FROM\ fungi\ f\ }}
\DoxyCodeLine{00123\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ fungi\_images\ fi\ ON\ f.id\ =\ fi.fungi\_id\ }}
\DoxyCodeLine{00124\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ images\ i\ ON\ fi.image\_id\ =\ i.id\ }}
\DoxyCodeLine{00125\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ image\_config\ ic\ ON\ i.config\_key\ =\ ic.config\_key}}
\DoxyCodeLine{00126\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ WHERE\ f.id\ =\ :id}}
\DoxyCodeLine{00127\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\ BY\ f.id"{}},\ [\textcolor{stringliteral}{'id'}\ =>\ \$id]);}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$result\ instanceof\ \(\backslash\)PDOStatement)\ \$fungus\ =\ \$result-\/>fetch(\(\backslash\)PDO::FETCH\_ASSOC)\ ?:\ \textcolor{keyword}{null};}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_array(\$result)\ \&\&\ !empty(\$result)\ \&\&\ isset(\$result[0]))\ \$fungus\ =\ \$result[0];}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \$fungus\ =\ \$result;}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$fungus)\ \$fungus\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a69ba801a8491aa101cefc5928144e616}{loadFungusImages}}(\$fungus);}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$fungus;}
\DoxyCodeLine{00136\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{FungiController_8php_source_l00173}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}load\+Fungus\+Images()}}.



Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00269}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}detail\+Fungus\+Handler()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a0bb355407938be2032959dd234e0b13c_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a0bb355407938be2032959dd234e0b13c_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451}\label{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getFungusWithLikeStatus@{getFungusWithLikeStatus}}
\index{getFungusWithLikeStatus@{getFungusWithLikeStatus}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getFungusWithLikeStatus()}{getFungusWithLikeStatus()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Fungus\+With\+Like\+Status (\begin{DoxyParamCaption}\item[{}]{\$fungus,  }\item[{}]{\$user\+Id }\end{DoxyParamCaption})}



Añade el estado de like de un usuario a la información de un hongo. 


\begin{DoxyParams}[1]{Parámetros}
array & {\em \$fungus} & Datos del hongo \\
\hline
int & {\em \$user\+Id} & ID del usuario\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Datos del hongo con el estado de like añadido 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00106}{106}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00107\ \ \ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$fungus\ \&\&\ \$userId)\ \$fungus[\textcolor{stringliteral}{'is\_liked'}]\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a35fbbcc5cad471348611c0e1cfafebd7}{hasUserLikedFungi}}(\$userId,\ \$fungus[\textcolor{stringliteral}{'id'}]);}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$fungus;}
\DoxyCodeLine{00110\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{FungiController_8php_source_l00092}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}has\+User\+Liked\+Fungi()}}.



Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00639}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Detailed\+Fungus\+By\+Id()}}, \mbox{\hyperlink{FungiController_8php_source_l00568}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Random\+Fungus\+With\+Details()}} y \mbox{\hyperlink{FungiController_8php_source_l00240}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}random\+Fungus\+Handler()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a7f868fa3d67eefa14cd17d62e80b3d3d}\label{classApp_1_1Controllers_1_1FungiController_a7f868fa3d67eefa14cd17d62e80b3d3d} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getImageBasePath@{getImageBasePath}}
\index{getImageBasePath@{getImageBasePath}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getImageBasePath()}{getImageBasePath()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Image\+Base\+Path (\begin{DoxyParamCaption}\item[{}]{\$config\+Key }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Obtiene la ruta base para las imágenes según la clave de configuración. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$config\+Key} & Clave de configuración \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
string Ruta base para las imágenes 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00219}{219}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00220\ \ \ \ \ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mapeo\ de\ claves\ de\ configuración\ a\ rutas\ base}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \$pathMap\ =\ [}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'fungi\_upload\_path'}\ =>\ \textcolor{stringliteral}{'/assets/images'},}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'user\_upload\_path'}\ =>\ \textcolor{stringliteral}{'/assets/images/users'},}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'system\_images'}\ =>\ \textcolor{stringliteral}{'/assets/images/system'}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Devolver\ la\ ruta\ correspondiente\ o\ una\ ruta\ predeterminada}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$pathMap[\$configKey]\ ??\ \textcolor{stringliteral}{'/assets/images'};}
\DoxyCodeLine{00230\ \ \ \ \ \}}

\end{DoxyCode}


Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00173}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}load\+Fungus\+Images()}}.

Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a7f868fa3d67eefa14cd17d62e80b3d3d_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a3a07c5dd018b701663a2a46a52f74a6d}\label{classApp_1_1Controllers_1_1FungiController_a3a07c5dd018b701663a2a46a52f74a6d} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getRandomFungus@{getRandomFungus}}
\index{getRandomFungus@{getRandomFungus}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getRandomFungus()}{getRandomFungus()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Random\+Fungus (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Obtiene un hongo aleatorio de la base de datos. 

\begin{DoxyReturn}{Devuelve}
array\texorpdfstring{$\vert$}{|}null Datos del hongo aleatorio o null si no se encuentra ninguno 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00143}{143}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00144\ \ \ \ \ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \$query\ =\ \textcolor{stringliteral}{"{}SELECT\ *\ FROM\ fungi\ ORDER\ BY\ RAND()\ LIMIT\ 1"{}};}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \$randomResult\ =\ \$this-\/>db-\/>query(\$query);}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Procesar\ el\ resultado\ según\ el\ tipo\ de\ retorno\ de\ la\ DB}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$randomResult\ instanceof\ \(\backslash\)PDOStatement)\ \$fungus\ =\ \$randomResult-\/>fetch(\(\backslash\)PDO::FETCH\_ASSOC);}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (is\_array(\$randomResult)\ \&\&\ !empty(\$randomResult))\ \$fungus\ =\ isset(\$randomResult[0])\ ?\ \$randomResult[0]\ :\ \$randomResult;}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \$fungus\ =\ \textcolor{keyword}{null};}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$fungus)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incrementar\ el\ contador\ de\ vistas\ para\ este\ hongo}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a4e795756d06c8d0ff755c20645eddb12}{incrementFungiViews}}(\$fungus[\textcolor{stringliteral}{'id'}]);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cargar\ las\ imágenes\ relacionadas}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a69ba801a8491aa101cefc5928144e616}{loadFungusImages}}(\$fungus);}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Registrar\ para\ depuración}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}Cargando\ hongo\ aleatorio:\ "{}}\ .\ json\_encode(\$fungus[\textcolor{stringliteral}{'name'}]\ ??\ \textcolor{stringliteral}{'No\ encontrado'}));}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$fungus;}
\DoxyCodeLine{00165\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{FungiController_8php_source_l00074}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}increment\+Fungi\+Views()}} y \mbox{\hyperlink{FungiController_8php_source_l00173}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}load\+Fungus\+Images()}}.



Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00240}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}random\+Fungus\+Handler()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a3a07c5dd018b701663a2a46a52f74a6d_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a3a07c5dd018b701663a2a46a52f74a6d_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_adb3b5543b0cbd42fe6278ffb80df47a3}\label{classApp_1_1Controllers_1_1FungiController_adb3b5543b0cbd42fe6278ffb80df47a3} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!getRandomFungusWithDetails@{getRandomFungusWithDetails}}
\index{getRandomFungusWithDetails@{getRandomFungusWithDetails}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{getRandomFungusWithDetails()}{getRandomFungusWithDetails()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::get\+Random\+Fungus\+With\+Details (\begin{DoxyParamCaption}\item[{}]{\$user\+Id = {\ttfamily null} }\end{DoxyParamCaption})}



Obtiene un hongo aleatorio. 


\begin{DoxyParams}[1]{Parámetros}
int | null & {\em \$user\+Id} & ID del usuario actual (para likes) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Datos del hongo aleatorio 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00568}{568}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00569\ \ \ \ \ \{}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \$sql\ =\ \textcolor{stringliteral}{"{}SELECT\ f.*,\ GROUP\_CONCAT(DISTINCT\ CONCAT(ic.path,\ i.filename))\ as\ image\_urls\ }}
\DoxyCodeLine{00571\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FROM\ fungi\ f\ }}
\DoxyCodeLine{00572\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ fungi\_images\ fi\ ON\ f.id\ =\ fi.fungi\_id\ }}
\DoxyCodeLine{00573\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ images\ i\ ON\ fi.image\_id\ =\ i.id\ }}
\DoxyCodeLine{00574\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ image\_config\ ic\ ON\ i.config\_key\ =\ ic.config\_key}}
\DoxyCodeLine{00575\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\ BY\ f.id}}
\DoxyCodeLine{00576\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ORDER\ BY\ RAND()\ }}
\DoxyCodeLine{00577\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LIMIT\ 1"{}};}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \$fungus\ =\ \$this-\/>db-\/>query(\$sql);}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (empty(\$fungus))\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ }
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'No\ hay\ hongos\ disponibles'}}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convertir\ resultado\ a\ un\ solo\ hongo}}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_array(\$fungus)\ \&\&\ !empty(\$fungus))\ \{}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus\ =\ \$fungus[0];}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incrementar\ contador\ de\ vistas}}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a4e795756d06c8d0ff755c20645eddb12}{incrementFungiViews}}(\$fungus[\textcolor{stringliteral}{'id'}]);}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ hay\ un\ usuario\ autenticado,\ verificar\ si\ le\ dio\ like}}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$userId)\ \{}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451}{getFungusWithLikeStatus}}(\$fungus,\ \$userId);}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'data'}\ =>\ \$fungus}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00605\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{FungiController_8php_source_l00106}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Fungus\+With\+Like\+Status()}} y \mbox{\hyperlink{FungiController_8php_source_l00074}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}increment\+Fungi\+Views()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_adb3b5543b0cbd42fe6278ffb80df47a3_cgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a35fbbcc5cad471348611c0e1cfafebd7}\label{classApp_1_1Controllers_1_1FungiController_a35fbbcc5cad471348611c0e1cfafebd7} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!hasUserLikedFungi@{hasUserLikedFungi}}
\index{hasUserLikedFungi@{hasUserLikedFungi}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{hasUserLikedFungi()}{hasUserLikedFungi()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::has\+User\+Liked\+Fungi (\begin{DoxyParamCaption}\item[{}]{\$user\+Id,  }\item[{}]{\$fungi\+Id }\end{DoxyParamCaption})}



Verifica si un usuario ha dado like a un hongo. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$user\+Id} & ID del usuario \\
\hline
int & {\em \$fungi\+Id} & ID del hongo\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
bool TRUE si el usuario ha dado like, FALSE en caso contrario 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00092}{92}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00093\ \ \ \ \ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}SELECT\ 1\ FROM\ user\_likes\ WHERE\ user\_id\ =\ ?\ AND\ fungi\_id\ =\ ?"{}},\ [\$userId,\ \$fungiId]);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !empty(\$result);}
\DoxyCodeLine{00096\ \ \ \ \ \}}

\end{DoxyCode}


Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00106}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Fungus\+With\+Like\+Status()}}.

Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a35fbbcc5cad471348611c0e1cfafebd7_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a4e795756d06c8d0ff755c20645eddb12}\label{classApp_1_1Controllers_1_1FungiController_a4e795756d06c8d0ff755c20645eddb12} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!incrementFungiViews@{incrementFungiViews}}
\index{incrementFungiViews@{incrementFungiViews}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{incrementFungiViews()}{incrementFungiViews()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::increment\+Fungi\+Views (\begin{DoxyParamCaption}\item[{}]{\$fungi\+Id }\end{DoxyParamCaption})}



Incrementa el contador de vistas de un hongo. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$fungi\+Id} & ID del hongo\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
bool Resultado de la operación 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00074}{74}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00075\ \ \ \ \ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}INSERT\ INTO\ fungi\_popularity\ (fungi\_id,\ views,\ likes)\ VALUES\ (?,\ 1,\ 0)\ ON\ DUPLICATE\ KEY\ UPDATE\ views\ =\ views\ +\ 1"{}},\ [\$fungiId]);}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}Error\ incrementando\ vistas:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \ \ \}}

\end{DoxyCode}


Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00639}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Detailed\+Fungus\+By\+Id()}}, \mbox{\hyperlink{FungiController_8php_source_l00143}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Random\+Fungus()}} y \mbox{\hyperlink{FungiController_8php_source_l00568}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Random\+Fungus\+With\+Details()}}.

Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a4e795756d06c8d0ff755c20645eddb12_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a61834711a6b3748eca87a0644c08babb}\label{classApp_1_1Controllers_1_1FungiController_a61834711a6b3748eca87a0644c08babb} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!likeFungi@{likeFungi}}
\index{likeFungi@{likeFungi}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{likeFungi()}{likeFungi()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::like\+Fungi (\begin{DoxyParamCaption}\item[{}]{\$user\+Id,  }\item[{}]{\$fungi\+Id }\end{DoxyParamCaption})}



Registra que un usuario ha dado like a un hongo. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$user\+Id} & ID del usuario \\
\hline
int & {\em \$fungi\+Id} & ID del hongo\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
mixed Resultado de la consulta a la base de datos 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00036}{36}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00037\ \ \ \ \ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}INSERT\ INTO\ user\_likes\ (user\_id,\ fungi\_id)\ VALUES\ (?,\ ?)"{}},\ [\$userId,\ \$fungiId]);}
\DoxyCodeLine{00039\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a69ba801a8491aa101cefc5928144e616}\label{classApp_1_1Controllers_1_1FungiController_a69ba801a8491aa101cefc5928144e616} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!loadFungusImages@{loadFungusImages}}
\index{loadFungusImages@{loadFungusImages}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{loadFungusImages()}{loadFungusImages()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::load\+Fungus\+Images (\begin{DoxyParamCaption}\item[{}]{\$fungus }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Carga las imágenes relacionadas con un hongo desde la tabla de relaciones. 


\begin{DoxyParams}[1]{Parámetros}
array & {\em \$fungus} & Datos del hongo \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Datos del hongo con las URLs de imágenes añadidas 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00173}{173}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00174\ \ \ \ \ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Consultar\ las\ imágenes\ relacionadas\ a\ través\ de\ la\ tabla\ de\ relación}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \$imagesResult\ =\ \$this-\/>db-\/>query(}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}SELECT\ i.filename,\ i.config\_key\ }}
\DoxyCodeLine{00178\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ FROM\ images\ i\ }}
\DoxyCodeLine{00179\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ JOIN\ fungi\_images\ fi\ ON\ i.id\ =\ fi.image\_id\ }}
\DoxyCodeLine{00180\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ WHERE\ fi.fungi\_id\ =\ ?"{}},}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ [\$fungus[\textcolor{stringliteral}{'id'}]]}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \$imageUrls\ =\ [];}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ hay\ resultados,\ procesarlos}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$imagesResult)\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$imagesResult\ instanceof\ \(\backslash\)PDOStatement)\ \$images\ =\ \$imagesResult-\/>fetchAll(\(\backslash\)PDO::FETCH\_ASSOC);}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \$images\ =\ is\_array(\$imagesResult)\ ?\ \$imagesResult\ :\ [\$imagesResult];}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\$images\ as\ \$image)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Construir\ la\ URL\ completa\ de\ la\ imagen\ basada\ en\ la\ config\_key}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$basePath\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a7f868fa3d67eefa14cd17d62e80b3d3d}{getImageBasePath}}(\$image[\textcolor{stringliteral}{'config\_key'}]);}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$imageUrls[]\ =\ \$basePath\ .\ \textcolor{charliteral}{'/'}\ .\ \$image[\textcolor{stringliteral}{'filename'}];}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ no\ hay\ imágenes,\ usar\ una\ por\ defecto}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (empty(\$imageUrls))\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \$imageUrls[]\ =\ \textcolor{stringliteral}{'/assets/images/placeholder.jpg'};}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}No\ se\ encontraron\ imágenes\ para\ el\ hongo\ ID:\ "{}}\ .\ \$fungus[\textcolor{stringliteral}{'id'}]);}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Guardar\ las\ URLs\ como\ una\ cadena\ separada\ por\ comas\ (para\ mantener\ compatibilidad)}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \$fungus[\textcolor{stringliteral}{'image\_urls'}]\ =\ implode(\textcolor{charliteral}{','},\ \$imageUrls);}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Para\ depuración}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}URLs\ de\ imágenes\ para\ hongo\ ID\ "{}}\ .\ \$fungus[\textcolor{stringliteral}{'id'}]\ .\ \textcolor{stringliteral}{"{}:\ "{}}\ .\ \$fungus[\textcolor{stringliteral}{'image\_urls'}]);}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$fungus;}
\DoxyCodeLine{00211\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{FungiController_8php_source_l00219}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Image\+Base\+Path()}}.



Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00118}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Fungus\+By\+Id()}} y \mbox{\hyperlink{FungiController_8php_source_l00143}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Random\+Fungus()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a69ba801a8491aa101cefc5928144e616_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_a69ba801a8491aa101cefc5928144e616_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_ade6fc0ad20f30ba8d2ba5efcf3d7064c}\label{classApp_1_1Controllers_1_1FungiController_ade6fc0ad20f30ba8d2ba5efcf3d7064c} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!randomFungusHandler@{randomFungusHandler}}
\index{randomFungusHandler@{randomFungusHandler}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{randomFungusHandler()}{randomFungusHandler()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::random\+Fungus\+Handler (\begin{DoxyParamCaption}\item[{}]{\$twig,  }\item[{}]{\$db,  }\item[{}]{\$session }\end{DoxyParamCaption})}



Manejador para la ruta de hongo aleatorio. 


\begin{DoxyParams}[1]{Parámetros}
object & {\em \$twig} & Instancia de Twig \\
\hline
object & {\em \$db} & Instancia de la base de datos \\
\hline
object & {\em \$session} & Controlador de sesión \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Datos para la plantilla 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00240}{240}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00241\ \ \ \ \ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtener\ un\ hongo\ aleatorio}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \$fungus\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_a3a07c5dd018b701663a2a46a52f74a6d}{getRandomFungus}}();}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\$fungus)\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ header(\textcolor{stringliteral}{'Location:\ /404'});}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ exit;}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Añadir\ información\ de\ like\ si\ el\ usuario\ está\ logueado}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{routes_8php_abefb3c26429d514777313e9a63d7cbac}{\$session}}-\/>isLoggedIn())\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \$fungus\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1FungiController_add0b456287a79c088c78a9fe8c469451}{getFungusWithLikeStatus}}(\$fungus,\ \$\_SESSION[\textcolor{stringliteral}{'user\_id'}]);}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'title'}\ =>\ \_(\textcolor{stringliteral}{'Hongo\ aleatorio'}),}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'fungi'}\ =>\ \$fungus}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00259\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{routes_8php_source_l00093}{\$session}}, \mbox{\hyperlink{FungiController_8php_source_l00106}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Fungus\+With\+Like\+Status()}} y \mbox{\hyperlink{FungiController_8php_source_l00143}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}get\+Random\+Fungus()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1FungiController_ade6fc0ad20f30ba8d2ba5efcf3d7064c_cgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_abad44269a6c73137a0beec822ae8a627}\label{classApp_1_1Controllers_1_1FungiController_abad44269a6c73137a0beec822ae8a627} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!searchFungi@{searchFungi}}
\index{searchFungi@{searchFungi}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{searchFungi()}{searchFungi()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::search\+Fungi (\begin{DoxyParamCaption}\item[{}]{\$param,  }\item[{}]{\$value }\end{DoxyParamCaption})}



Busca hongos por parámetro y valor. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$param} & Parámetro de búsqueda \\
\hline
string & {\em \$value} & Valor a buscar \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Resultados de la búsqueda 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00524}{524}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00525\ \ \ \ \ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \$allowedParams\ =\ [\textcolor{stringliteral}{'name'},\ \textcolor{stringliteral}{'edibility'},\ \textcolor{stringliteral}{'habitat'},\ \textcolor{stringliteral}{'common\_name'}];}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!in\_array(\$param,\ \$allowedParams))\ \{}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'Parámetro\ de\ búsqueda\ no\ válido.\ Parámetros\ permitidos:\ '}\ .\ implode(\textcolor{stringliteral}{',\ '},\ \$allowedParams)}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Construir\ la\ consulta\ de\ búsqueda\ segura}}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \$sql\ =\ \textcolor{stringliteral}{"{}SELECT\ f.*,\ GROUP\_CONCAT(DISTINCT\ CONCAT(ic.path,\ i.filename))\ as\ image\_urls\ }}
\DoxyCodeLine{00538\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FROM\ fungi\ f\ }}
\DoxyCodeLine{00539\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ fungi\_images\ fi\ ON\ f.id\ =\ fi.fungi\_id\ }}
\DoxyCodeLine{00540\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ images\ i\ ON\ fi.image\_id\ =\ i.id\ }}
\DoxyCodeLine{00541\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LEFT\ JOIN\ image\_config\ ic\ ON\ i.config\_key\ =\ ic.config\_key}}
\DoxyCodeLine{00542\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ WHERE\ f.\{\$param\}\ LIKE\ ?}}
\DoxyCodeLine{00543\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GROUP\ BY\ f.id}}
\DoxyCodeLine{00544\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LIMIT\ 50"{}};}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \$results\ =\ \$this-\/>db-\/>query(\$sql,\ [\textcolor{charliteral}{'\%'}\ .\ \$value\ .\ \textcolor{charliteral}{'\%'}]);}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'count'}\ =>\ count(\$results),}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'data'}\ =>\ \$results}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}Error\ en\ búsqueda\ de\ hongos:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'Error\ en\ la\ búsqueda:\ '}\ .\ \$e-\/>getMessage()}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00560\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_a087b8275e77143716ac62ea228074a20}\label{classApp_1_1Controllers_1_1FungiController_a087b8275e77143716ac62ea228074a20} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!unlikeFungi@{unlikeFungi}}
\index{unlikeFungi@{unlikeFungi}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{unlikeFungi()}{unlikeFungi()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::unlike\+Fungi (\begin{DoxyParamCaption}\item[{}]{\$user\+Id,  }\item[{}]{\$fungi\+Id }\end{DoxyParamCaption})}



Elimina el like de un usuario a un hongo. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$user\+Id} & ID del usuario \\
\hline
int & {\em \$fungi\+Id} & ID del hongo\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
mixed Resultado de la consulta a la base de datos 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00049}{49}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00050\ \ \ \ \ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}DELETE\ FROM\ user\_likes\ WHERE\ user\_id\ =\ ?\ AND\ fungi\_id\ =\ ?"{}},\ [\$userId,\ \$fungiId]);}
\DoxyCodeLine{00052\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_abd8eabf4c1f810b847481dc4af02691b}\label{classApp_1_1Controllers_1_1FungiController_abd8eabf4c1f810b847481dc4af02691b} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!updateFungi@{updateFungi}}
\index{updateFungi@{updateFungi}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{updateFungi()}{updateFungi()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::update\+Fungi (\begin{DoxyParamCaption}\item[{}]{\$fungi\+Id,  }\item[{}]{\$data,  }\item[{}]{\$user = {\ttfamily null} }\end{DoxyParamCaption})}



Actualiza la información de un hongo. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$fungi\+Id} & ID del hongo a actualizar \\
\hline
array & {\em \$data} & Nuevos datos del hongo \\
\hline
array & {\em \$user} & Usuario que realiza la operación \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Resultado de la operación 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00305}{305}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00306\ \ \ \ \ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ permisos\ de\ administrador\ si\ se\ proporciona\ usuario}}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$user\ \&\&\ (!isset(\$user[\textcolor{stringliteral}{'role'}])\ ||\ \$user[\textcolor{stringliteral}{'role'}]\ !==\ \textcolor{stringliteral}{'admin'}))\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'No\ tienes\ permisos\ para\ realizar\ esta\ operación'}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ que\ el\ hongo\ exista}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \$checkResult\ =\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}SELECT\ id\ FROM\ fungi\ WHERE\ id\ =\ ?"{}},\ [\$fungiId]);}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\$checkResult\ ||\ (\$checkResult\ instanceof\ \(\backslash\)PDOStatement\ \&\&\ !\$checkResult-\/>fetch()))\ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'El\ hongo\ especificado\ no\ existe'}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Construir\ consulta\ dinámica}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \$fields\ =\ [];}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \$values\ =\ [];}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\$data\ as\ \$field\ =>\ \$value)\ \{}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Solo\ permitir\ campos\ válidos}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_array(\$field,\ [\textcolor{stringliteral}{'name'},\ \textcolor{stringliteral}{'edibility'},\ \textcolor{stringliteral}{'habitat'},\ \textcolor{stringliteral}{'observations'},\ \textcolor{stringliteral}{'common\_name'},\ \textcolor{stringliteral}{'synonym'},\ \textcolor{stringliteral}{'title'}]))\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$fields[]\ =\ \textcolor{stringliteral}{"{}\$field\ =\ ?"{}};}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$values[]\ =\ \$value;}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (empty(\$fields))\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'No\ se\ proporcionaron\ campos\ válidos\ para\ actualizar'}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Agregar\ ID\ para\ la\ cláusula\ WHERE}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \$values[]\ =\ \$fungiId;}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \$sql\ =\ \textcolor{stringliteral}{"{}UPDATE\ fungi\ SET\ "{}}\ .\ implode(\textcolor{stringliteral}{',\ '},\ \$fields)\ .\ \textcolor{stringliteral}{"{}\ WHERE\ id\ =\ ?"{}};}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>db-\/>query(\$sql,\ \$values);}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$result)\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Hongo\ actualizado\ correctamente'}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'Error\ al\ actualizar\ el\ hongo\ en\ la\ base\ de\ datos'}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}Error\ actualizando\ hongo:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \textcolor{stringliteral}{'Error\ interno\ del\ servidor:\ '}\ .\ \$e-\/>getMessage()}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00368\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_af994c3d12f7062ddd44a40c3505bff3d}\label{classApp_1_1Controllers_1_1FungiController_af994c3d12f7062ddd44a40c3505bff3d} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!updateFungiLikes@{updateFungiLikes}}
\index{updateFungiLikes@{updateFungiLikes}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{updateFungiLikes()}{updateFungiLikes()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::update\+Fungi\+Likes (\begin{DoxyParamCaption}\item[{}]{\$fungi\+Id,  }\item[{}]{\$increment }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Actualiza el contador de likes de un hongo. 


\begin{DoxyParams}[1]{Parámetros}
int & {\em \$fungi\+Id} & ID del hongo \\
\hline
int & {\em \$increment} & Valor de incremento (positivo) o decremento (negativo)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
mixed Resultado de la consulta a la base de datos 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00062}{62}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00063\ \ \ \ \ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>db-\/>query(\textcolor{stringliteral}{"{}UPDATE\ fungi\_popularity\ SET\ likes\ =\ likes\ +\ ?\ WHERE\ fungi\_id\ =\ ?"{}},\ [\$increment,\ \$fungiId]);}
\DoxyCodeLine{00065\ \ \ \ \ \}}

\end{DoxyCode}


\doxysubsection{Documentación de datos miembro}
\Hypertarget{classApp_1_1Controllers_1_1FungiController_ab1b8e71c0976e182854ff195764611c6}\label{classApp_1_1Controllers_1_1FungiController_ab1b8e71c0976e182854ff195764611c6} 
\index{App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}!\$db@{\$db}}
\index{\$db@{\$db}!App\textbackslash{}Controllers\textbackslash{}FungiController@{App\textbackslash{}Controllers\textbackslash{}FungiController}}
\doxysubsubsection{\texorpdfstring{\$db}{\$db}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\+::\$db\hspace{0.3cm}{\ttfamily [private]}}



Definición en la línea \mbox{\hyperlink{FungiController_8php_source_l00016}{16}} del archivo \mbox{\hyperlink{FungiController_8php_source}{Fungi\+Controller.\+php}}.



Referenciado por \mbox{\hyperlink{FungiController_8php_source_l00023}{App\textbackslash{}\+Controllers\textbackslash{}\+Fungi\+Controller\textbackslash{}\+\_\+\+\_\+construct()}}.



La documentación de esta clase está generada del siguiente archivo\+:\begin{DoxyCompactItemize}
\item 
src/controllers/\mbox{\hyperlink{FungiController_8php}{Fungi\+Controller.\+php}}\end{DoxyCompactItemize}
