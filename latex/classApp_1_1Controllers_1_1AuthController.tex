\doxysection{Referencia de la clase App\textbackslash{}Controllers\textbackslash{}Auth\+Controller}
\hypertarget{classApp_1_1Controllers_1_1AuthController}{}\label{classApp_1_1Controllers_1_1AuthController}\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}


Controlador para gestionar la autenticación de usuarios.  




Diagrama de colaboración de App\textbackslash{}Controllers\textbackslash{}Auth\+Controller\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=239pt]{classApp_1_1Controllers_1_1AuthController__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Métodos públicos}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a695f556152eb441e50be47d1d92cbe83}{\+\_\+\+\_\+construct}} (\mbox{\hyperlink{classApp_1_1Controllers_1_1DatabaseController}{Database\+Controller}} \$db)
\begin{DoxyCompactList}\small\item\em Constructor del controlador de autenticación. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_aa0db53139c1ebc5414b5e4985a46b4ae}{is\+Logged\+In}} ()
\begin{DoxyCompactList}\small\item\em Verifica si el usuario está autenticado. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_af4914b619824cf44e74a5c7c625cab73}{login}} (\$username, \$password)
\begin{DoxyCompactList}\small\item\em Inicia sesión de un usuario. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a2898c39d96be7bc4075106d3ffa29d86}{login\+Handler}} (\$twig, \$db, \$session)
\begin{DoxyCompactList}\small\item\em Maneja la solicitud de inicio de sesión. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a4dcca8154953e71c03799ebd9ae20ed0}{logout}} ()
\begin{DoxyCompactList}\small\item\em Cierra la sesión del usuario. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a9da33a37873dfc1289351f23429d2416}{logout\+And\+Redirect}} ()
\begin{DoxyCompactList}\small\item\em Cierra la sesión del usuario y redirige a la página principal. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a667c9941898e5f7ecd35eb2112fcdc20}{register}} (\$username, \$email, \$password, \$confirm\+\_\+password)
\begin{DoxyCompactList}\small\item\em Registra un nuevo usuario en el sistema. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ac968c9c1fcbc6ac91cc7f20c3181b94f}{register\+Handler}} ()
\begin{DoxyCompactList}\small\item\em Maneja la solicitud de registro de usuario. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_af4fd64293b9488b0ec68a243b7cdd6d0}{verify\+Token}} (\$jwt)
\begin{DoxyCompactList}\small\item\em Verifica un token JWT. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Métodos privados}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c}{base64\+URLEncode}} (\$data)
\begin{DoxyCompactList}\small\item\em Codifica en Base64 URL seguro. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_acbdad71780d5fdd8b8245739664aba6b}{create\+JWT}} (\$user)
\begin{DoxyCompactList}\small\item\em Crea un token JWT para el usuario. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a722aae18417e35bad00c945dd381da08}{create\+Secure\+Cookie}} (\$name, \$value, \$expires, \$path)
\begin{DoxyCompactList}\small\item\em Crea una cookie segura. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ab06917fbe57ab9b399e1d66d81807c4f}{generate\+JWT}} (\$header, \$payload)
\begin{DoxyCompactList}\small\item\em Genera un token JWT. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a239c918cc9affeb44f560d762bdf61ce}{generate\+Session\+Token}} (\$user)
\begin{DoxyCompactList}\small\item\em Genera un token de sesión para el usuario. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a303b63d25aff7ffc1fdc5b8dfef00f73}{get\+Secret\+Key}} ()
\begin{DoxyCompactList}\small\item\em Obtiene la clave secreta para JWT. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a3f7891576bdfc3deb4030d5d5db57bae}{remove\+Auth\+Cookies}} ()
\begin{DoxyCompactList}\small\item\em Elimina todas las cookies relacionadas con la autenticación. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Atributos privados}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a465b9cef5ddf7ccf230d87780229ded3}{\$db}}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_af616276e8a28a39a17283cbb7b2e021c}{\$secret\+Key}}
\item 
\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a14e4702d0832b0c6ebffd00f21fef46d}{\$session}}
\end{DoxyCompactItemize}


\doxysubsection{Descripción detallada}
Controlador para gestionar la autenticación de usuarios. 

Esta clase maneja el registro, inicio de sesión, cierre de sesión y verificación de tokens para los usuarios del sistema. 

Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00015}{15}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.



\doxysubsection{Documentación de constructores y destructores}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a695f556152eb441e50be47d1d92cbe83}\label{classApp_1_1Controllers_1_1AuthController_a695f556152eb441e50be47d1d92cbe83} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!\_\_construct@{\_\_construct}}
\index{\_\_construct@{\_\_construct}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{\_\_construct()}{\_\_construct()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::\+\_\+\+\_\+construct (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classApp_1_1Controllers_1_1DatabaseController}{Database\+Controller}}}]{\$db }\end{DoxyParamCaption})}



Constructor del controlador de autenticación. 


\begin{DoxyParams}[1]{Parámetros}
Database\+Controller & {\em \$db} & Instancia del controlador de base de datos \\
\hline
\end{DoxyParams}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00025}{25}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \$this-\/>db\ =\ \mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a465b9cef5ddf7ccf230d87780229ded3}{\$db}};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \$this-\/>session\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classApp_1_1Controllers_1_1SessionController}{SessionController}}(\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a465b9cef5ddf7ccf230d87780229ded3}{\$db}});}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \$this-\/>secretKey\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a303b63d25aff7ffc1fdc5b8dfef00f73}{getSecretKey}}();}
\DoxyCodeLine{00029\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00016}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}\$db}} y \mbox{\hyperlink{AuthController_8php_source_l00399}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}get\+Secret\+Key()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a695f556152eb441e50be47d1d92cbe83_cgraph}
\end{center}
\end{figure}


\doxysubsection{Documentación de funciones miembro}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c}\label{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!base64URLEncode@{base64URLEncode}}
\index{base64URLEncode@{base64URLEncode}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{base64URLEncode()}{base64URLEncode()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::base64\+URLEncode (\begin{DoxyParamCaption}\item[{}]{\$data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Codifica en Base64 URL seguro. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$data} & Datos a codificar \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
string Datos codificados 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00365}{365}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ str\_replace([\textcolor{charliteral}{'+'},\ \textcolor{charliteral}{'/'},\ \textcolor{charliteral}{'='}],\ [\textcolor{charliteral}{'-\/'},\ \textcolor{charliteral}{'\_'},\ \textcolor{stringliteral}{''}],\ base64\_encode(\$data));}
\DoxyCodeLine{00367\ \ \ \ \ \}}

\end{DoxyCode}


Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00310}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}generate\+JWT()}} y \mbox{\hyperlink{AuthController_8php_source_l00324}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}verify\+Token()}}.

Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_acbdad71780d5fdd8b8245739664aba6b}\label{classApp_1_1Controllers_1_1AuthController_acbdad71780d5fdd8b8245739664aba6b} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!createJWT@{createJWT}}
\index{createJWT@{createJWT}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{createJWT()}{createJWT()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::create\+JWT (\begin{DoxyParamCaption}\item[{}]{\$user }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Crea un token JWT para el usuario. 


\begin{DoxyParams}[1]{Parámetros}
array & {\em \$user} & Datos del usuario \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
string Token JWT
\end{DoxyReturn}
Datos para el JWT\+:
\begin{DoxyItemize}
\item Header\+: algoritmo HS256 y tipo JWT
\item Payload\+: ID y username del usuario, expiración en 30 días
\item Se guarda en cookie y base de datos 
\end{DoxyItemize}

Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00281}{281}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \$header\ =\ [\textcolor{stringliteral}{'alg'}\ =>\ \textcolor{stringliteral}{'HS256'},\ \textcolor{stringliteral}{'typ'}\ =>\ \textcolor{stringliteral}{'JWT'}];}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \$payload\ =\ [}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'user\_id'}\ =>\ \$user[\textcolor{stringliteral}{'id'}],}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'username'}\ =>\ \$user[\textcolor{stringliteral}{'username'}],}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'exp'}\ =>\ time()\ +\ 86400\ *\ 30}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \$jwt\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ab06917fbe57ab9b399e1d66d81807c4f}{generateJWT}}(\$header,\ \$payload);}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a722aae18417e35bad00c945dd381da08}{createSecureCookie}}(\textcolor{stringliteral}{"{}jwt"{}},\ \$jwt,\ time()\ +\ (86400\ *\ 30),\ \textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \$this-\/>db-\/>query(}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}UPDATE\ users\ SET\ jwt\ =\ ?\ WHERE\ id\ =\ ?"{}},}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ [\$jwt,\ \$user[\textcolor{stringliteral}{'id'}]]}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$jwt;}
\DoxyCodeLine{00295\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00378}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}create\+Secure\+Cookie()}} y \mbox{\hyperlink{AuthController_8php_source_l00310}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}generate\+JWT()}}.



Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00093}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}login()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_acbdad71780d5fdd8b8245739664aba6b_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_acbdad71780d5fdd8b8245739664aba6b_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a722aae18417e35bad00c945dd381da08}\label{classApp_1_1Controllers_1_1AuthController_a722aae18417e35bad00c945dd381da08} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!createSecureCookie@{createSecureCookie}}
\index{createSecureCookie@{createSecureCookie}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{createSecureCookie()}{createSecureCookie()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::create\+Secure\+Cookie (\begin{DoxyParamCaption}\item[{}]{\$name,  }\item[{}]{\$value,  }\item[{}]{\$expires,  }\item[{}]{\$path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Crea una cookie segura. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$name} & Nombre de la cookie \\
\hline
string & {\em \$value} & Valor de la cookie \\
\hline
int & {\em \$expires} & Tiempo de expiración \\
\hline
string & {\em \$path} & Ruta de la cookie \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
bool Resultado de la operación 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00378}{378}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \$domain\ =\ \textcolor{stringliteral}{''};}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \$secure\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Cambiar\ a\ true\ en\ producción\ con\ HTTPS}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \$httponly\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ setcookie(}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \$name,}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \$value,}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \$expires,}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \$path,}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \$domain,}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \$secure,}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \$httponly}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00392\ \ \ \ \ \}}

\end{DoxyCode}


Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00281}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}create\+JWT()}} y \mbox{\hyperlink{AuthController_8php_source_l00254}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}generate\+Session\+Token()}}.

Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a722aae18417e35bad00c945dd381da08_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_ab06917fbe57ab9b399e1d66d81807c4f}\label{classApp_1_1Controllers_1_1AuthController_ab06917fbe57ab9b399e1d66d81807c4f} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!generateJWT@{generateJWT}}
\index{generateJWT@{generateJWT}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{generateJWT()}{generateJWT()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::generate\+JWT (\begin{DoxyParamCaption}\item[{}]{\$header,  }\item[{}]{\$payload }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Genera un token JWT. 


\begin{DoxyParams}[1]{Parámetros}
array & {\em \$header} & Cabecera del token \\
\hline
array & {\em \$payload} & Datos del token \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
string Token JWT generado
\end{DoxyReturn}

\begin{DoxyEnumerate}
\item Codifica el header y payload en base64url
\item Crea una firma HMAC SHA256 usando la clave secreta
\item Codifica la firma en base64url
\item Concatena las tres partes con puntos para crear el JWT 
\end{DoxyEnumerate}

Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00310}{310}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \$header\_encoded\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c}{base64URLEncode}}(json\_encode(\$header));}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \$payload\_encoded\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c}{base64URLEncode}}(json\_encode(\$payload));}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \$signature\ =\ hash\_hmac(\textcolor{stringliteral}{'sha256'},\ \textcolor{stringliteral}{"{}\$header\_encoded.\$payload\_encoded"{}},\ \$this-\/>secretKey,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \$signature\_encoded\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c}{base64URLEncode}}(\$signature);}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}\$header\_encoded.\$payload\_encoded.\$signature\_encoded"{}};}
\DoxyCodeLine{00316\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00365}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}base64\+URLEncode()}}.



Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00281}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}create\+JWT()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_ab06917fbe57ab9b399e1d66d81807c4f_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_ab06917fbe57ab9b399e1d66d81807c4f_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a239c918cc9affeb44f560d762bdf61ce}\label{classApp_1_1Controllers_1_1AuthController_a239c918cc9affeb44f560d762bdf61ce} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!generateSessionToken@{generateSessionToken}}
\index{generateSessionToken@{generateSessionToken}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{generateSessionToken()}{generateSessionToken()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::generate\+Session\+Token (\begin{DoxyParamCaption}\item[{}]{\$user }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Genera un token de sesión para el usuario. 


\begin{DoxyParams}[1]{Parámetros}
array & {\em \$user} & Datos del usuario \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
string Token generado 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00254}{254}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generar\ token\ aleatorio}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \$token\ =\ bin2hex(random\_bytes(16));}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Guardar\ en\ cookie}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a722aae18417e35bad00c945dd381da08}{createSecureCookie}}(\textcolor{stringliteral}{"{}token"{}},\ \$token,\ time()\ +\ (86400\ *\ 30),\ \textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Guardar\ en\ base\ de\ datos}}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \$this-\/>db-\/>query(}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}UPDATE\ users\ SET\ token\ =\ ?\ WHERE\ id\ =\ ?"{}},}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ [\$token,\ \$user[\textcolor{stringliteral}{'id'}]]}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$token;}
\DoxyCodeLine{00268\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00378}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}create\+Secure\+Cookie()}}.



Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00093}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}login()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a239c918cc9affeb44f560d762bdf61ce_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a239c918cc9affeb44f560d762bdf61ce_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a303b63d25aff7ffc1fdc5b8dfef00f73}\label{classApp_1_1Controllers_1_1AuthController_a303b63d25aff7ffc1fdc5b8dfef00f73} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!getSecretKey@{getSecretKey}}
\index{getSecretKey@{getSecretKey}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{getSecretKey()}{getSecretKey()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::get\+Secret\+Key (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Obtiene la clave secreta para JWT. 

\begin{DoxyReturn}{Devuelve}
string Clave secreta 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00399}{399}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cargar\ desde\ .env\ o\ usar\ una\ clave\ predeterminada}}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (function\_exists(\textcolor{stringliteral}{'getenv'})\ \&\&\ getenv(\textcolor{stringliteral}{'JWT\_SECRET\_KEY'}))\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ getenv(\textcolor{stringliteral}{'JWT\_SECRET\_KEY'});}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Cambiar\ en\ producción}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'tu\_clave\_secreta\_segura\_para\_jwt'};}
\DoxyCodeLine{00406\ \ \ \ \ \}}

\end{DoxyCode}


Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00025}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}\+\_\+\+\_\+construct()}}.

Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a303b63d25aff7ffc1fdc5b8dfef00f73_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_aa0db53139c1ebc5414b5e4985a46b4ae}\label{classApp_1_1Controllers_1_1AuthController_aa0db53139c1ebc5414b5e4985a46b4ae} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!isLoggedIn@{isLoggedIn}}
\index{isLoggedIn@{isLoggedIn}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{isLoggedIn()}{isLoggedIn()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::is\+Logged\+In (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Verifica si el usuario está autenticado. 

\begin{DoxyReturn}{Devuelve}
bool Resultado de la verificación 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00413}{413}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ session\_start();}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ sesión}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_SESSION[\textcolor{stringliteral}{'user\_id'}]))\ \{}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ token\ de\ cookie}}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_COOKIE[\textcolor{stringliteral}{'token'}]))\ \{}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \$token\ =\ \$\_COOKIE[\textcolor{stringliteral}{'token'}];}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \$user\ =\ \$this-\/>db-\/>query(}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}SELECT\ *\ FROM\ users\ WHERE\ token\ =\ ?"{}},}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$token]}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ )-\/>fetch();}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$user)\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_SESSION[\textcolor{stringliteral}{'user\_id'}]\ =\ \$user[\textcolor{stringliteral}{'id'}];}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_SESSION[\textcolor{stringliteral}{'username'}]\ =\ \$user[\textcolor{stringliteral}{'username'}];}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ JWT}}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_COOKIE[\textcolor{stringliteral}{'jwt'}]))\ \{}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \$jwt\ =\ \$\_COOKIE[\textcolor{stringliteral}{'jwt'}];}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \$payload\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_af4fd64293b9488b0ec68a243b7cdd6d0}{verifyToken}}(\$jwt);}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$payload\ \&\&\ isset(\$payload[\textcolor{stringliteral}{'user\_id'}]))\ \{}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_SESSION[\textcolor{stringliteral}{'user\_id'}]\ =\ \$payload[\textcolor{stringliteral}{'user\_id'}];}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_SESSION[\textcolor{stringliteral}{'username'}]\ =\ \$payload[\textcolor{stringliteral}{'username'}];}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00449\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00324}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}verify\+Token()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_aa0db53139c1ebc5414b5e4985a46b4ae_cgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_af4914b619824cf44e74a5c7c625cab73}\label{classApp_1_1Controllers_1_1AuthController_af4914b619824cf44e74a5c7c625cab73} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!login@{login}}
\index{login@{login}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{login()}{login()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::login (\begin{DoxyParamCaption}\item[{}]{\$username,  }\item[{}]{\$password }\end{DoxyParamCaption})}



Inicia sesión de un usuario. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$username} & Nombre de usuario o correo \\
\hline
string & {\em \$password} & Contraseña\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Arreglo con el resultado de la operación \mbox{[}\textquotesingle{}success\textquotesingle{} =\texorpdfstring{$>$}{>} bool, \textquotesingle{}message\textquotesingle{} =\texorpdfstring{$>$}{>} string, \textquotesingle{}user\textquotesingle{} =\texorpdfstring{$>$}{>} object\texorpdfstring{$\vert$}{|}null\mbox{]} 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00093}{93}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ si\ es\ un\ nombre\ de\ usuario\ o\ correo}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \$field\ =\ filter\_var(\$username,\ FILTER\_VALIDATE\_EMAIL)\ ?\ \textcolor{stringliteral}{'email'}\ :\ \textcolor{stringliteral}{'username'};}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Buscar\ usuario}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \$user\ =\ \$this-\/>db-\/>query(}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}SELECT\ *\ FROM\ users\ WHERE\ \$field\ =\ ?"{}},}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$username]}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ )-\/>fetch();}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\$user)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Credenciales\ inválidas'},\ \textcolor{stringliteral}{'user'}\ =>\ \textcolor{keyword}{null}];}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ contraseña}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!password\_verify(\$password,\ \$user[\textcolor{stringliteral}{'password\_hash'}]))\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Credenciales\ inválidas'},\ \textcolor{stringliteral}{'user'}\ =>\ \textcolor{keyword}{null}];}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Iniciar\ sesión}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ session\_start();}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \$\_SESSION[\textcolor{stringliteral}{'user\_id'}]\ =\ \$user[\textcolor{stringliteral}{'id'}];}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \$\_SESSION[\textcolor{stringliteral}{'username'}]\ =\ \$user[\textcolor{stringliteral}{'username'}];}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generar\ token\ de\ sesión}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \$token\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a239c918cc9affeb44f560d762bdf61ce}{generateSessionToken}}(\$user);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generar\ JWT\ y\ almacenarlo}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \$jwt\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_acbdad71780d5fdd8b8245739664aba6b}{createJWT}}(\$user);}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actualizar\ último\ login}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>db-\/>query(}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}UPDATE\ users\ SET\ last\_login\ =\ NOW()\ WHERE\ id\ =\ ?"{}},}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$user[\textcolor{stringliteral}{'id'}]]}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Sesión\ iniciada\ correctamente'},}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'user'}\ =>\ \$user}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Error\ al\ iniciar\ sesión:\ '}\ .\ \$e-\/>getMessage(),}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'user'}\ =>\ null}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00281}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}create\+JWT()}} y \mbox{\hyperlink{AuthController_8php_source_l00254}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}generate\+Session\+Token()}}.



Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00498}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}login\+Handler()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_af4914b619824cf44e74a5c7c625cab73_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_af4914b619824cf44e74a5c7c625cab73_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a2898c39d96be7bc4075106d3ffa29d86}\label{classApp_1_1Controllers_1_1AuthController_a2898c39d96be7bc4075106d3ffa29d86} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!loginHandler@{loginHandler}}
\index{loginHandler@{loginHandler}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{loginHandler()}{loginHandler()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::login\+Handler (\begin{DoxyParamCaption}\item[{}]{\$twig,  }\item[{}]{\$db,  }\item[{}]{\$session }\end{DoxyParamCaption})}



Maneja la solicitud de inicio de sesión. 

Procesa el formulario de inicio de sesión cuando se envía por POST o prepara la vista del formulario cuando se accede por GET. Compatible con el sistema de rutas de la aplicación.


\begin{DoxyParams}[1]{Parámetros}
object & {\em \$twig} & Instancia de Twig \\
\hline
object & {\em \$db} & Instancia de la base de datos \\
\hline
object & {\em \$session} & Controlador de sesión \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Datos para la plantilla 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00498}{498}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00499\ \ \ \ \ \{}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$\_SERVER[\textcolor{stringliteral}{'REQUEST\_METHOD'}]\ ===\ \textcolor{stringliteral}{'POST'})\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_af4914b619824cf44e74a5c7c625cab73}{login}}(}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_POST[\textcolor{stringliteral}{'username'}]\ ??\ \textcolor{stringliteral}{''},}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_POST[\textcolor{stringliteral}{'password'}]\ ??\ \textcolor{stringliteral}{''}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$result[\textcolor{stringliteral}{'success'}])\ \{}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ header(\textcolor{stringliteral}{'Location:\ /'});}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ exit;}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'title'}\ =>\ \_(\textcolor{stringliteral}{'Iniciar\ Sesión'}),}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \$result[\textcolor{stringliteral}{'message'}]}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \$registered\ =\ isset(\$\_GET[\textcolor{stringliteral}{'registered'}])\ ?\ true\ :\ \textcolor{keyword}{false};}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'title'}\ =>\ \_(\textcolor{stringliteral}{'Iniciar\ Sesión'}),}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'success'}\ =>\ \$registered\ ?\ \_(\textcolor{stringliteral}{'Usuario\ registrado\ exitosamente.\ Por\ favor\ inicia\ sesión.'})\ :\ null}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00522\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00093}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}login()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a2898c39d96be7bc4075106d3ffa29d86_cgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a4dcca8154953e71c03799ebd9ae20ed0}\label{classApp_1_1Controllers_1_1AuthController_a4dcca8154953e71c03799ebd9ae20ed0} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!logout@{logout}}
\index{logout@{logout}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{logout()}{logout()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::logout (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Cierra la sesión del usuario. 

Elimina todas las cookies de sesión, tokens y destruye la sesión actual. Utiliza los tokens disponibles para una identificación más precisa.

\begin{DoxyReturn}{Devuelve}
void 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00152}{152}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Iniciar\ sesión\ si\ no\ está\ iniciada}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (session\_status()\ ==\ PHP\_SESSION\_NONE)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ session\_start();}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Recopilar\ todos\ los\ identificadores\ disponibles}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \$identifiers\ =\ [];}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ID\ de\ usuario\ en\ sesión}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_SESSION[\textcolor{stringliteral}{'user\_id'}]))\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \$identifiers[\textcolor{stringliteral}{'user\_id'}]\ =\ \$\_SESSION[\textcolor{stringliteral}{'user\_id'}];}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Token\ de\ sesión\ en\ cookie}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_COOKIE[\textcolor{stringliteral}{'token'}]))\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \$identifiers[\textcolor{stringliteral}{'token'}]\ =\ \$\_COOKIE[\textcolor{stringliteral}{'token'}];}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ JWT\ en\ cookie}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_COOKIE[\textcolor{stringliteral}{'jwt'}]))\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \$identifiers[\textcolor{stringliteral}{'jwt'}]\ =\ \$\_COOKIE[\textcolor{stringliteral}{'jwt'}];}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Limpiar\ tokens\ en\ la\ base\ de\ datos\ usando\ todos\ los\ identificadores\ disponibles}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!empty(\$identifiers))\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$identifiers[\textcolor{stringliteral}{'user\_id'}]))\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>db-\/>query(}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}UPDATE\ users\ SET\ token\ =\ NULL,\ jwt\ =\ NULL\ WHERE\ id\ =\ ?"{}},}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$identifiers[\textcolor{stringliteral}{'user\_id'}]]}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$identifiers[\textcolor{stringliteral}{'token'}]))\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>db-\/>query(}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}UPDATE\ users\ SET\ token\ =\ NULL\ WHERE\ token\ =\ ?"{}},}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$identifiers[\textcolor{stringliteral}{'token'}]]}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$identifiers[\textcolor{stringliteral}{'jwt'}]))\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>db-\/>query(}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}UPDATE\ users\ SET\ jwt\ =\ NULL\ WHERE\ jwt\ =\ ?"{}},}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$identifiers[\textcolor{stringliteral}{'jwt'}]]}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Registrar\ error\ pero\ continuar\ con\ el\ proceso\ de\ logout}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\textcolor{stringliteral}{"{}Error\ al\ limpiar\ tokens:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Eliminar\ cookies\ relacionadas\ con\ la\ autenticación}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a3f7891576bdfc3deb4030d5d5db57bae}{removeAuthCookies}}();}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Destruir\ la\ sesión}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ session\_destroy();}
\DoxyCodeLine{00210\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00217}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}remove\+Auth\+Cookies()}}.



Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00239}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}logout\+And\+Redirect()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a4dcca8154953e71c03799ebd9ae20ed0_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a4dcca8154953e71c03799ebd9ae20ed0_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a9da33a37873dfc1289351f23429d2416}\label{classApp_1_1Controllers_1_1AuthController_a9da33a37873dfc1289351f23429d2416} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!logoutAndRedirect@{logoutAndRedirect}}
\index{logoutAndRedirect@{logoutAndRedirect}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{logoutAndRedirect()}{logoutAndRedirect()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::logout\+And\+Redirect (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Cierra la sesión del usuario y redirige a la página principal. 

\begin{DoxyReturn}{Devuelve}
void 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00239}{239}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Llamar\ al\ método\ logout\ para\ limpiar\ la\ sesión}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_a4dcca8154953e71c03799ebd9ae20ed0}{logout}}();}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Redirigir\ a\ la\ página\ principal}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ header(\textcolor{stringliteral}{'Location:\ /'});}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ exit;}
\DoxyCodeLine{00246\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00152}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}logout()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a9da33a37873dfc1289351f23429d2416_cgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a667c9941898e5f7ecd35eb2112fcdc20}\label{classApp_1_1Controllers_1_1AuthController_a667c9941898e5f7ecd35eb2112fcdc20} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!register@{register}}
\index{register@{register}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{register()}{register()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::register (\begin{DoxyParamCaption}\item[{}]{\$username,  }\item[{}]{\$email,  }\item[{}]{\$password,  }\item[{}]{\$confirm\+\_\+password }\end{DoxyParamCaption})}



Registra un nuevo usuario en el sistema. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$username} & Nombre de usuario \\
\hline
string & {\em \$email} & Correo electrónico del usuario \\
\hline
string & {\em \$password} & Contraseña del usuario \\
\hline
string & {\em \$confirm\+\_\+password} & Confirmación de la contraseña\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
array Arreglo con el resultado de la operación \mbox{[}\textquotesingle{}success\textquotesingle{} =\texorpdfstring{$>$}{>} bool, \textquotesingle{}message\textquotesingle{} =\texorpdfstring{$>$}{>} string\mbox{]} 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00042}{42}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Validaciones\ básicas}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (empty(\$username)\ ||\ empty(\$email)\ ||\ empty(\$password))\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Todos\ los\ campos\ son\ requeridos'}];}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Validar\ longitud\ del\ username}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strlen(\$username)\ <\ 3\ ||\ strlen(\$username)\ >\ 50)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'El\ nombre\ de\ usuario\ debe\ tener\ entre\ 3\ y\ 50\ caracteres'}];}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$password\ !==\ \$confirm\_password)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Las\ contraseñas\ no\ coinciden'}];}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Validar\ longitud\ del\ password}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strlen(\$password)\ <\ 8)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'La\ contraseña\ debe\ tener\ al\ menos\ 8\ caracteres'}];}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!filter\_var(\$email,\ FILTER\_VALIDATE\_EMAIL))\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Email\ inválido'}];}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hash\ del\ password\ antes\ de\ guardarlo}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \$hashed\_password\ =\ password\_hash(\$password,\ PASSWORD\_DEFAULT);}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Usar\ el\ UserController\ para\ crear\ el\ usuario}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{routes_8php_ab98c1855a5ef469dd8a4c83ed3b45a88}{\$userController}}\ =\ \textcolor{keyword}{new}\ UserController(\$this-\/>db,\ \$this-\/>session);}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{routes_8php_ab98c1855a5ef469dd8a4c83ed3b45a88}{\$userController}}-\/>createUser(\$username,\ \$email,\ \$hashed\_password))\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{true},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Usuario\ registrado\ exitosamente'}];}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'El\ usuario\ o\ email\ ya\ existe'}];}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Log\ del\ error\ para\ el\ administrador}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ error\_log(\$e-\/>getMessage());}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{stringliteral}{'success'}\ =>\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Error\ al\ registrar\ el\ usuario'}];}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{routes_8php_source_l00096}{\$user\+Controller}}.

\Hypertarget{classApp_1_1Controllers_1_1AuthController_ac968c9c1fcbc6ac91cc7f20c3181b94f}\label{classApp_1_1Controllers_1_1AuthController_ac968c9c1fcbc6ac91cc7f20c3181b94f} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!registerHandler@{registerHandler}}
\index{registerHandler@{registerHandler}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{registerHandler()}{registerHandler()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::register\+Handler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Maneja la solicitud de registro de usuario. 

Procesa el formulario de registro cuando se envía por POST o prepara la vista del formulario cuando se accede por GET. Compatible con el sistema de rutas de la aplicación.

\begin{DoxyReturn}{Devuelve}
array Datos para la plantilla 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00460}{460}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00461\ \ \ \ \ \{}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$\_SERVER[\textcolor{stringliteral}{'REQUEST\_METHOD'}]\ ===\ \textcolor{stringliteral}{'POST'})\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>\textcolor{keyword}{register}(}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_POST[\textcolor{stringliteral}{'username'}]\ ??\ \textcolor{stringliteral}{''},}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_POST[\textcolor{stringliteral}{'email'}]\ ??\ \textcolor{stringliteral}{''},}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_POST[\textcolor{stringliteral}{'password'}]\ ??\ \textcolor{stringliteral}{''},}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$\_POST[\textcolor{stringliteral}{'confirm\_password'}]\ ??\ \textcolor{stringliteral}{''}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$result[\textcolor{stringliteral}{'success'}])\ \{}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ header(\textcolor{stringliteral}{'Location:\ /login?registered=1'});}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ exit;}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'title'}\ =>\ \_(\textcolor{stringliteral}{'Registro'}),}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error'}\ =>\ \$result[\textcolor{stringliteral}{'message'}]}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'title'}\ =>\ \_(\textcolor{stringliteral}{'Registro'})}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ ];}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00484\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a3f7891576bdfc3deb4030d5d5db57bae}\label{classApp_1_1Controllers_1_1AuthController_a3f7891576bdfc3deb4030d5d5db57bae} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!removeAuthCookies@{removeAuthCookies}}
\index{removeAuthCookies@{removeAuthCookies}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{removeAuthCookies()}{removeAuthCookies()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::remove\+Auth\+Cookies (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Elimina todas las cookies relacionadas con la autenticación. 

\begin{DoxyReturn}{Devuelve}
void 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00217}{217}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Eliminar\ cookie\ de\ token}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_COOKIE[\textcolor{stringliteral}{'token'}]))\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ setcookie(\textcolor{stringliteral}{"{}token"{}},\ \textcolor{stringliteral}{"{}"{}},\ time()\ -\/\ 3600,\ \textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Eliminar\ cookie\ de\ JWT}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_COOKIE[\textcolor{stringliteral}{'jwt'}]))\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ setcookie(\textcolor{stringliteral}{"{}jwt"{}},\ \textcolor{stringliteral}{"{}"{}},\ time()\ -\/\ 3600,\ \textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Eliminar\ otras\ cookies\ de\ sesión\ que\ puedan\ existir}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$\_COOKIE[session\_name()]))\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ setcookie(session\_name(),\ \textcolor{stringliteral}{"{}"{}},\ time()\ -\/\ 3600,\ \textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \}}

\end{DoxyCode}


Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00152}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}logout()}}.

Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_a3f7891576bdfc3deb4030d5d5db57bae_icgraph}
\end{center}
\end{figure}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_af4fd64293b9488b0ec68a243b7cdd6d0}\label{classApp_1_1Controllers_1_1AuthController_af4fd64293b9488b0ec68a243b7cdd6d0} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!verifyToken@{verifyToken}}
\index{verifyToken@{verifyToken}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{verifyToken()}{verifyToken()}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::verify\+Token (\begin{DoxyParamCaption}\item[{}]{\$jwt }\end{DoxyParamCaption})}



Verifica un token JWT. 


\begin{DoxyParams}[1]{Parámetros}
string & {\em \$jwt} & Token JWT a verificar \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Devuelve}
mixed Datos decodificados o false 
\end{DoxyReturn}


Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00324}{324}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ si\ el\ token\ existe\ en\ la\ base\ de\ datos}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \$tokenData\ =\ \$this-\/>db-\/>query(}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}SELECT\ *\ FROM\ users\ WHERE\ jwt\ =\ ?"{}},}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\$jwt]}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ )-\/>fetch();}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\$tokenData)\ \{}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ estructura\ del\ token}}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ list(\$header\_encoded,\ \$payload\_encoded,\ \$signature\_encoded)\ =\ explode(\textcolor{charliteral}{'.'},\ \$jwt);}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ firma}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \$signature\ =\ hash\_hmac(\textcolor{stringliteral}{'sha256'},\ \textcolor{stringliteral}{"{}\$header\_encoded.\$payload\_encoded"{}},\ \$this-\/>secretKey,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \$signature\_check\ =\ \$this-\/>\mbox{\hyperlink{classApp_1_1Controllers_1_1AuthController_ae746c781d06673e1ce59121abf11c36c}{base64URLEncode}}(\$signature);}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$signature\_encoded\ !==\ \$signature\_check)\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verificar\ expiración}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \$payload\ =\ json\_decode(base64\_decode(\$payload\_encoded),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isset(\$payload[\textcolor{stringliteral}{'exp'}])\ \&\&\ \$payload[\textcolor{stringliteral}{'exp'}]\ <\ time())\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Expirado}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$payload;}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00357\ \ \ \ \ \}}

\end{DoxyCode}


Hace referencia a \mbox{\hyperlink{AuthController_8php_source_l00365}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}base64\+URLEncode()}}.



Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00413}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}is\+Logged\+In()}}.

Gráfico de llamadas de esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_af4fd64293b9488b0ec68a243b7cdd6d0_cgraph}
\end{center}
\end{figure}
Gráfico de llamadas a esta función\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classApp_1_1Controllers_1_1AuthController_af4fd64293b9488b0ec68a243b7cdd6d0_icgraph}
\end{center}
\end{figure}


\doxysubsection{Documentación de datos miembro}
\Hypertarget{classApp_1_1Controllers_1_1AuthController_a465b9cef5ddf7ccf230d87780229ded3}\label{classApp_1_1Controllers_1_1AuthController_a465b9cef5ddf7ccf230d87780229ded3} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!\$db@{\$db}}
\index{\$db@{\$db}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{\$db}{\$db}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::\$db\hspace{0.3cm}{\ttfamily [private]}}



Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00016}{16}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.



Referenciado por \mbox{\hyperlink{AuthController_8php_source_l00025}{App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\textbackslash{}\+\_\+\+\_\+construct()}}.

\Hypertarget{classApp_1_1Controllers_1_1AuthController_af616276e8a28a39a17283cbb7b2e021c}\label{classApp_1_1Controllers_1_1AuthController_af616276e8a28a39a17283cbb7b2e021c} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!\$secretKey@{\$secretKey}}
\index{\$secretKey@{\$secretKey}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{\$secretKey}{\$secretKey}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::\$secret\+Key\hspace{0.3cm}{\ttfamily [private]}}



Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00018}{18}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.

\Hypertarget{classApp_1_1Controllers_1_1AuthController_a14e4702d0832b0c6ebffd00f21fef46d}\label{classApp_1_1Controllers_1_1AuthController_a14e4702d0832b0c6ebffd00f21fef46d} 
\index{App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}!\$session@{\$session}}
\index{\$session@{\$session}!App\textbackslash{}Controllers\textbackslash{}AuthController@{App\textbackslash{}Controllers\textbackslash{}AuthController}}
\doxysubsubsection{\texorpdfstring{\$session}{\$session}}
{\footnotesize\ttfamily App\textbackslash{}\+Controllers\textbackslash{}\+Auth\+Controller\+::\$session\hspace{0.3cm}{\ttfamily [private]}}



Definición en la línea \mbox{\hyperlink{AuthController_8php_source_l00017}{17}} del archivo \mbox{\hyperlink{AuthController_8php_source}{Auth\+Controller.\+php}}.



La documentación de esta clase está generada del siguiente archivo\+:\begin{DoxyCompactItemize}
\item 
src/controllers/\mbox{\hyperlink{AuthController_8php}{Auth\+Controller.\+php}}\end{DoxyCompactItemize}
