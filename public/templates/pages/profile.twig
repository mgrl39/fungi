<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - Perfil de Usuario</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets/lib/twbs/bootstrap/dist/css/bootstrap.min.css">
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="/assets/styles/generic.css">
    <link rel="stylesheet" href="/assets/styles/components/navbar.css">
    <link rel="stylesheet" href="/assets/styles/components/footer.css">
    <link rel="stylesheet" href="/assets/styles/pages/profile.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/assets/lib/fontawesome/fontawesome-free-6.4.0-web/css/all.min.css">
    
    <!-- Animate.css y AOS -->
    <link rel="stylesheet" href="/assets/lib/animate.css/animate.min.css">
    <link rel="stylesheet" href="/assets/lib/aos/aos.css">    
</head>
<body>
    <header>
        {% include 'components/navbar.twig' %}
    </header>

    <main>
        <!-- Cabecera del perfil -->
        <section class="profile-header animate__animated animate__fadeIn">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-3 col-md-4 text-center">
                        <div class="rounded-circle overflow-hidden mx-auto mb-3" style="width: 200px; height: 200px;">
                            <img src="{{ user.avatar_url|default('/assets/users/default-avatar.png') }}" 
                                 alt="Avatar de {{ user.username }}" 
                                 class="w-100 h-100 object-fit-cover">
                        </div>
                    </div>
                    <div class="col-lg-9 col-md-8">
                        <h1 class="display-4">{{ user.username }}</h1>
                        <p class="text-primary fs-5 mb-2">
                            <i class="fas fa-envelope me-2"></i>{{ user.email|default('No disponible') }}
                        </p>
                        <p class="lead">{{ user.bio|default('Este usuario todavía no ha añadido una biografía.') }}</p>
                        <div class="d-flex flex-wrap mb-3">
                            <span class="badge bg-primary me-2 mb-2 p-2"><i class="fas fa-calendar-alt me-1"></i> Miembro desde {{ user.created_at|date("d/m/Y") }}</span>
                            <span class="badge bg-success me-2 mb-2 p-2"><i class="fas fa-upload me-1"></i> {{ user.contributions|default(0) }} Contribuciones</span>
                            <span class="badge bg-info me-2 mb-2 p-2"><i class="fas fa-map-marker-alt me-1"></i> {{ user.location|default('Sin ubicación') }}</span>
                        </div>
                        {% if is_own_profile %}
                        <div class="mt-3">
                            <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                                <i class="fas fa-edit me-1"></i> Editar perfil
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <!-- Contenido del perfil -->
        <div class="container py-4">
            <div class="row">
                <div class="col-md-12">
                    <div class="card bg-dark text-light border-secondary">
                        <div class="card-header">
                            <!-- Pestañas de navegación -->
                            <ul class="nav nav-tabs card-header-tabs" id="profileTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="activity-tab" data-bs-toggle="tab" 
                                            data-bs-target="#activity" type="button" role="tab" 
                                            aria-controls="activity" aria-selected="true">
                                        <i class="fas fa-chart-line me-1"></i> Actividad
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="favorites-tab" data-bs-toggle="tab" 
                                            data-bs-target="#favorites" type="button" role="tab" 
                                            aria-controls="favorites" aria-selected="false">
                                        <i class="fas fa-heart me-1"></i> Favoritos
                                    </button>
                                </li>
                                {% if is_own_profile %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="settings-tab" data-bs-toggle="tab" 
                                            data-bs-target="#settings" type="button" role="tab" 
                                            aria-controls="settings" aria-selected="false">
                                        <i class="fas fa-cog me-1"></i> Configuración
                                    </button>
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                        <div class="card-body">
                            <!-- Contenido de las pestañas -->
                            <div class="tab-content profile-tabs-content" id="profileTabsContent">
                                
                                <!-- Pestaña de Actividad -->
                                <div class="tab-pane fade show active profile-tab-content" id="activity" role="tabpanel" aria-labelledby="activity-tab">
                                    <h3 class="mb-4">Actividad reciente</h3>
                                    
                                    <div class="row row-cols-1 row-cols-md-2 g-4">
                                        <div class="col">
                                            <div class="card h-100 shadow-sm" data-aos="fade-up">
                                                <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
                                                    <span><i class="fas fa-trophy me-2"></i> Estadísticas</span>
                                                </div>
                                                <div class="card-body bg-white text-dark">
                                                    <div class="row">
                                                        <div class="col-6 mb-4 text-center">
                                                            <div class="p-3 rounded-circle mx-auto mb-2" style="width: 70px; height: 70px; background-color: rgba(13, 110, 253, 0.1);">
                                                                <i class="fas fa-heart text-primary fa-2x"></i>
                                                            </div>
                                                            <h3 class="text-primary">{{ user.favorites_count|default(0) }}</h3>
                                                            <p class="text-muted">Favoritos</p>
                                                        </div>
                                                        <div class="col-6 mb-4 text-center">
                                                            <div class="p-3 rounded-circle mx-auto mb-2" style="width: 70px; height: 70px; background-color: rgba(25, 135, 84, 0.1);">
                                                                <i class="fas fa-comment text-success fa-2x"></i>
                                                            </div>
                                                            <h3 class="text-success">{{ user.comments_count|default(0) }}</h3>
                                                            <p class="text-muted">Comentarios</p>
                                                        </div>
                                                        <div class="col-6 text-center">
                                                            <div class="p-3 rounded-circle mx-auto mb-2" style="width: 70px; height: 70px; background-color: rgba(13, 202, 240, 0.1);">
                                                                <i class="fas fa-thumbs-up text-info fa-2x"></i>
                                                            </div>
                                                            <h3 class="text-info">{{ user.likes_count|default(0) }}</h3>
                                                            <p class="text-muted">Me gusta</p>
                                                        </div>
                                                        <div class="col-6 text-center">
                                                            <div class="p-3 rounded-circle mx-auto mb-2" style="width: 70px; height: 70px; background-color: rgba(255, 193, 7, 0.1);">
                                                                <i class="fas fa-upload text-warning fa-2x"></i>
                                                            </div>
                                                            <h3 class="text-warning">{{ user.contributions|default(0) }}</h3>
                                                            <p class="text-muted">Contribuciones</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col">
                                            <div class="card h-100 shadow-sm" data-aos="fade-up" data-aos-delay="100">
                                                <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
                                                    <span><i class="fas fa-history me-2"></i> Últimas acciones</span>
                                                </div>
                                                <div class="card-body p-0 bg-white">
                                                    <ul class="list-group list-group-flush">
                                                        {% if user_actions is defined and user_actions|length > 0 %}
                                                            {% for action in user_actions %}
                                                            <li class="list-group-item border-bottom d-flex align-items-center">
                                                                <div class="me-3">
                                                                    <span class="badge rounded-pill bg-{{ action.color|default('primary') }} p-2">
                                                                        <i class="fas fa-{{ action.icon|default('check') }}"></i>
                                                                    </span>
                                                                </div>
                                                                <div class="flex-grow-1">
                                                                    <div>{{ action.description }}</div>
                                                                    <small class="text-muted">{{ action.date }}</small>
                                                                </div>
                                                            </li>
                                                            {% endfor %}
                                                        {% else %}
                                                        <li class="list-group-item d-flex align-items-center">
                                                            <div class="me-3">
                                                                <span class="badge rounded-pill bg-secondary p-2">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </div>
                                                            <div>No hay acciones recientes.</div>
                                                        </li>
                                                        {% endif %}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Pestaña de Favoritos -->
                                <div class="tab-pane fade profile-tab-content" id="favorites" role="tabpanel" aria-labelledby="favorites-tab">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h3>Hongos favoritos</h3>
                                    </div>
                                    
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <div class="card bg-dark border-light">
                                                <div class="card-header bg-dark border-light">
                                                    <h5 class="mb-0"><i class="fas fa-star text-warning me-2"></i> Mis hongos favoritos</h5>
                                                </div>
                                                <div class="card-body p-3">
                                                    <div class="row" id="favorites-container">
                                                        <!-- Los favoritos se cargarán aquí -->
                                                        <div class="col-12 text-center py-5">
                                                            <div class="spinner-border text-primary" role="status">
                                                                <span class="visually-hidden">Cargando...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <div class="card bg-dark border-light">
                                                <div class="card-header bg-dark border-light">
                                                    <h5 class="mb-0"><i class="fas fa-heart text-danger me-2"></i> Hongos que me gustan</h5>
                                                </div>
                                                <div class="card-body p-3">
                                                    <div class="row" id="likes-container">
                                                        <!-- Los likes se cargarán aquí -->
                                                        <div class="col-12 text-center py-5">
                                                            <div class="spinner-border text-primary" role="status">
                                                                <span class="visually-hidden">Cargando...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña de Configuración -->
                                {% if is_own_profile %}
                                <div class="tab-pane fade profile-tab-content" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                                    <h3 class="mb-4">Configuración de la cuenta</h3>
                                    
                                    <div class="card mb-4" data-aos="fade-up">
                                        <div class="card-header profile-card-header">
                                            <i class="fas fa-lock me-2"></i> Seguridad
                                        </div>
                                        <div class="card-body">
                                            <form id="passwordForm">
                                                <div class="mb-3">
                                                    <label for="current_password" class="form-label">Contraseña actual</label>
                                                    <input type="password" class="form-control" id="current_password" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="new_password" class="form-label">Nueva contraseña</label>
                                                    <input type="password" class="form-control" id="new_password" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="confirm_password" class="form-label">Confirmar contraseña</label>
                                                    <input type="password" class="form-control" id="confirm_password" required>
                                                </div>
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fas fa-save me-1"></i> Cambiar contraseña
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="card" data-aos="fade-up" data-aos-delay="200">
                                        <div class="card-header profile-card-header text-danger">
                                            <i class="fas fa-exclamation-triangle me-2"></i> Zona de peligro
                                        </div>
                                        <div class="card-body">
                                            <p class="text-danger">La siguiente accion es irreversible. Procede con precaución.</p>
                                            <div class="d-flex flex-column gap-3">
                                                <button id="deleteAccount" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                                    <i class="fas fa-user-slash me-1"></i> Eliminar mi cuenta
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        {% include 'components/footer.twig' %}
    </footer>

    <!-- Modal de edición de perfil -->
    {% if is_own_profile %}
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-light border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="editProfileModalLabel"><i class="fas fa-user-edit me-2"></i>Editar perfil</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">Nombre de usuario</label>
                            <div class="input-group">
                                <span class="input-group-text bg-dark text-light border-secondary"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control bg-dark text-light border-secondary" id="username" value="{{ user.username }}">
                            </div>
                            <div class="form-text text-warning">El nombre de usuario debe ser único. Si lo cambias, tendrás que iniciar sesión con el nuevo nombre.</div>
                        </div>
                        
                        <!-- Avatar -->
                        <div class="mb-3">
                            <label for="avatar" class="form-label">Avatar</label>
                            <input type="file" class="form-control bg-dark text-light border-secondary" id="avatar" accept="image/*" disabled>
                            <div class="mt-2 alert alert-warning">
                                <i class="fas fa-lock me-2"></i> Esta función está bloqueada. Para cambiar tu foto de perfil necesitas una <a href="/premium" class="alert-link">cuenta premium</a>.
                            </div>
                        </div>
                        
                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <div class="input-group">
                                <span class="input-group-text bg-dark text-light border-secondary"><i class="fas fa-envelope"></i></span>
                                <input type="email" class="form-control bg-dark text-light border-secondary" id="email" value="{{ user.email }}">
                            </div>
                        </div>
                        
                        <!-- Biografía -->
                        <div class="mb-3">
                            <label for="bio" class="form-label">Biografía</label>
                            <textarea class="form-control bg-dark text-light border-secondary" id="bio" rows="3">{{ user.bio }}</textarea>
                        </div>
                        
                        <!-- Fila con ubicación -->
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="location" class="form-label">Ubicación</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-dark text-light border-secondary"><i class="fas fa-map-marker-alt"></i></span>
                                    <input type="text" class="form-control bg-dark text-light border-secondary" id="location" value="{{ user.location }}">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveProfile">
                        <i class="fas fa-save me-1"></i> Guardar cambios
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar cuenta -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title text-danger" id="deleteAccountModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>Eliminar cuenta
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <p>¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer y perderás todos tus datos.</p>
                    </div>
                    <div class="mb-3">
                        <label for="delete_confirmation" class="form-label">Escribe "ELIMINAR" para confirmar:</label>
                        <input type="text" class="form-control bg-dark text-light border-secondary" id="delete_confirmation" required>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteAccount" disabled>
                        <i class="fas fa-user-slash me-1"></i> Eliminar permanentemente
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Scripts -->
    <script src="/assets/lib/jquery.min.js"></script>
    <script src="/assets/lib/twbs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        // Inicializar AOS y tooltips
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });
        
        // Tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
        
        {% if is_own_profile %}
        // Código para usuarios autenticados
        document.getElementById('delete_confirmation').addEventListener('input', function() {
            const deleteBtn = document.getElementById('confirmDeleteAccount');
            deleteBtn.disabled = this.value !== 'ELIMINAR';
        });
        
        // Guardar perfil (actualizado para incluir username)
        document.getElementById('saveProfile').addEventListener('click', function() {
            const formData = new FormData();
            formData.append('username', document.getElementById('username').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('bio', document.getElementById('bio').value);
            formData.append('location', document.getElementById('location').value);
            
            const avatarInput = document.getElementById('avatar');
            if (avatarInput.files.length > 0) {
                formData.append('avatar', avatarInput.files[0]);
            }
            
            // Simulación (reemplazar por el código real)
            console.log('Actualizando perfil...');
            console.log('Nuevo username:', document.getElementById('username').value);
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
            modal.hide();
            
            alert('Perfil actualizado correctamente');
        });
        
        // Eliminar favorito
        document.querySelectorAll('.remove-favorite').forEach(button => {
            button.addEventListener('click', function() {
                const fungiId = this.getAttribute('data-id');
                const cardElement = this.closest('.col');
                
                // Realizar solicitud para eliminar favorito
                fetch(`/api/user/favorites/${fungiId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin'
                })
                .then(response => {
                    if (response.ok) {
                        // Animación de eliminación
                        cardElement.style.transition = 'opacity 0.5s, transform 0.5s';
                        cardElement.style.opacity = '0';
                        cardElement.style.transform = 'scale(0.8)';
                        
                        setTimeout(() => {
                            cardElement.remove();
                            
                            // Si no quedan favoritos, mostrar mensaje
                            if (document.querySelectorAll('#favorites-container .col').length === 0) {
                                const noFavoritesMsg = `
                                    <div class="alert alert-info" role="alert">
                                        <i class="fas fa-info-circle me-2"></i> No has marcado ningún hongo como favorito.
                                    </div>
                                    <a href="/" class="btn btn-primary">
                                        <i class="fas fa-search me-1"></i> Explorar hongos
                                    </a>
                                `;
                                document.querySelector('#favorites-container').innerHTML = noFavoritesMsg;
                            }
                        }, 500);
                        
                        return response.json();
                    } else {
                        throw new Error('Error al eliminar favorito');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('No se pudo eliminar el favorito. Inténtalo de nuevo.');
                });
            });
        });
        {% endif %}

        document.addEventListener('DOMContentLoaded', function() {
            // Cargar favoritos
            fetch('/api/user/favorites', {
                method: 'GET',
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('favorites-container');
                if (data.success && data.data.length > 0) {
                    container.innerHTML = '';
                    data.data.forEach(fungi => {
                        container.innerHTML += `
                            <div class="col-md-4 col-lg-3 mb-3">
                                <div class="card bg-dark border-light h-100">
                                    <img src="${fungi.image_url || '/assets/images/placeholder.jpg'}" class="card-img-top" alt="${fungi.name}" style="height: 150px; object-fit: cover;">
                                    <div class="card-body">
                                        <h5 class="card-title">${fungi.name}</h5>
                                        <p class="card-text small">${fungi.edibility || 'Desconocido'}</p>
                                        <a href="/fungi/${fungi.id}" class="btn btn-sm btn-primary">Ver detalle</a>
                                        <button class="btn btn-sm btn-outline-warning remove-favorite" data-id="${fungi.id}">
                                            <i class="fas fa-star-slash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    // Inicializar listeners para eliminar favoritos
                    initRemoveFavoriteButtons();
                } else {
                    container.innerHTML = '<div class="col-12 text-center py-4"><p class="text-muted">No tienes hongos favoritos.</p></div>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('favorites-container').innerHTML = 
                    '<div class="col-12 text-center py-4"><p class="text-danger">Error al cargar los favoritos. Inténtalo más tarde.</p></div>';
            });
            
            // Cargar likes
            fetch('/api/user/likes', {
                method: 'GET',
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('likes-container');
                if (data.success && data.data.length > 0) {
                    container.innerHTML = '';
                    data.data.forEach(fungi => {
                        container.innerHTML += `
                            <div class="col-md-4 col-lg-3 mb-3">
                                <div class="card bg-dark border-light h-100">
                                    <img src="${fungi.image_url || '/assets/images/placeholder.jpg'}" class="card-img-top" alt="${fungi.name}" style="height: 150px; object-fit: cover;">
                                    <div class="card-body">
                                        <h5 class="card-title">${fungi.name}</h5>
                                        <p class="card-text small">${fungi.edibility || 'Desconocido'}</p>
                                        <a href="/fungi/${fungi.id}" class="btn btn-sm btn-primary">Ver detalle</a>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    container.innerHTML = '<div class="col-12 text-center py-4"><p class="text-muted">No has dado "me gusta" a ningún hongo.</p></div>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('likes-container').innerHTML = 
                    '<div class="col-12 text-center py-4"><p class="text-danger">Error al cargar los hongos que te gustan. Inténtalo más tarde.</p></div>';
            });
            
            // Función para inicializar los botones de eliminar favoritos
            function initRemoveFavoriteButtons() {
                document.querySelectorAll('.remove-favorite').forEach(button => {
                    button.addEventListener('click', function() {
                        const fungiId = this.getAttribute('data-id');
                        const cardElement = this.closest('.col-md-4');
                        
                        // Animación de desvanecimiento
                        cardElement.style.transition = 'opacity 0.5s ease';
                        cardElement.style.opacity = '0.5';
                        
                        // Realizar solicitud para eliminar favorito
                        fetch(`/api/user/favorites/${fungiId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            credentials: 'same-origin'
                        })
                        .then(response => {
                            if (response.ok) {
                                // Eliminar con animación
                                setTimeout(() => {
                                    cardElement.remove();
                                    
                                    // Si no quedan favoritos, mostrar mensaje
                                    if (document.querySelectorAll('#favorites-container .col-md-4').length === 0) {
                                        document.getElementById('favorites-container').innerHTML = 
                                            '<div class="col-12 text-center py-4"><p class="text-muted">No tienes hongos favoritos.</p></div>';
                                    }
                                }, 500);
                                
                                return response.json();
                            } else {
                                throw new Error('Error al eliminar favorito');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            cardElement.style.opacity = '1'; // Restaurar opacidad si falla
                            alert('No se pudo eliminar el favorito. Inténtalo de nuevo.');
                        });
                    });
                });
            }
        });
    </script>
</body>
</html>

<style>
    .profile-header {
        background: linear-gradient(135deg, #2c3e50, #4a5568);
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 0 0 15px 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
</style>
